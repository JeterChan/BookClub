# å¾Œç«¯å–®å…ƒæ¸¬è©¦è¨ˆåŠƒ (Backend Unit Test Plan)

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-12-17  
**å°ˆæ¡ˆ**: ç·šä¸Šè®€æ›¸æœƒå¹³å° (BookClub)  
**æ¸¬è©¦æ¡†æ¶**: pytest, pytest-cov  
**æ¸¬è©¦æ¨¡å‹**: ç™½ç®±æ¸¬è©¦ (White Box Testing)  
**ç›®æ¨™è¦†è“‹ç‡**: â‰¥ 80%

---

## ğŸ“‹ ç›®éŒ„

1. [æ¸¬è©¦ç­–ç•¥æ¦‚è¿°](#1-æ¸¬è©¦ç­–ç•¥æ¦‚è¿°)
2. [æ¸¬è©¦è¨ˆåŠƒä¾†æº](#2-æ¸¬è©¦è¨ˆåŠƒä¾†æº)
3. [æ¸¬è©¦æ¡ˆä¾‹ç”Ÿæˆæµç¨‹](#3-æ¸¬è©¦æ¡ˆä¾‹ç”Ÿæˆæµç¨‹)
4. [æ¸¬è©¦æ¨¡å‹èªªæ˜](#4-æ¸¬è©¦æ¨¡å‹èªªæ˜)
5. [è¦†è“‹ç‡è¨ˆç®—æ–¹æ³•](#5-è¦†è“‹ç‡è¨ˆç®—æ–¹æ³•)
6. [æ¸¬è©¦çµæ§‹èˆ‡çµ„ç¹”](#6-æ¸¬è©¦çµæ§‹èˆ‡çµ„ç¹”)
7. [å–®å…ƒæ¸¬è©¦æ¸…å–®](#7-å–®å…ƒæ¸¬è©¦æ¸…å–®)
8. [æ¸¬è©¦åŸ·è¡Œèˆ‡å ±å‘Š](#8-æ¸¬è©¦åŸ·è¡Œèˆ‡å ±å‘Š)
9. [å“è³ªæ¨™æº–èˆ‡é–€æª»](#9-å“è³ªæ¨™æº–èˆ‡é–€æª»)

---

## 1. æ¸¬è©¦ç­–ç•¥æ¦‚è¿°

### 1.1 æ¸¬è©¦é‡‘å­—å¡”ç­–ç•¥

æœ¬å°ˆæ¡ˆæ¡ç”¨ **æ¸¬è©¦é‡‘å­—å¡” (Test Pyramid)** ç­–ç•¥ï¼Œå–®å…ƒæ¸¬è©¦ä½æ–¼é‡‘å­—å¡”åº•å±¤ï¼š

```
        â•±â”€â”€â”€â”€â”€â”€â”€â”€â•²
       â•±   E2E    â•²      â† å°‘é‡ï¼ˆUI æµç¨‹æ¸¬è©¦ï¼‰
      â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
     â•± Integration  â•²    â† ä¸­é‡ï¼ˆAPI + DB æ¸¬è©¦ï¼‰
    â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
   â•±   Unit Tests     â•²  â† å¤§é‡ï¼ˆService + Model æ¸¬è©¦ï¼‰â˜…
  â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
```

### 1.2 å–®å…ƒæ¸¬è©¦å®šä½

- **ç›®æ¨™**: é©—è­‰å€‹åˆ¥å‡½æ•¸ã€Service å±¤ã€Model é©—è­‰é‚è¼¯çš„æ­£ç¢ºæ€§
- **ç¯„åœ**: æ‰€æœ‰ `app/services/`ã€`app/models/`ã€`app/core/` çš„å•†æ¥­é‚è¼¯
- **éš”é›¢æ€§**: ä½¿ç”¨ in-memory SQLiteï¼Œä¸ä¾è³´å¤–éƒ¨æœå‹™
- **é€Ÿåº¦**: å¿«é€ŸåŸ·è¡Œï¼ˆ< 30 ç§’å®Œæˆæ‰€æœ‰å–®å…ƒæ¸¬è©¦ï¼‰

### 1.3 æ¸¬è©¦æª”æ¡ˆçµ±è¨ˆ

- **å–®å…ƒæ¸¬è©¦æª”æ¡ˆ**: 17 å€‹
- **å–®å…ƒæ¸¬è©¦æ¡ˆä¾‹**: 103 å€‹
- **ç•¶å‰è¦†è“‹ç‡**: 84.44%

*è¨»: æ•´åˆæ¸¬è©¦æœ‰ 12 å€‹æª”æ¡ˆã€91 å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼Œæœ¬æ–‡ä»¶åƒ…æ¶µè“‹å–®å…ƒæ¸¬è©¦ç¯„ç–‡*

---

## 2. æ¸¬è©¦è¨ˆåŠƒä¾†æº

### 2.1 éœ€æ±‚é©…å‹•æ¸¬è©¦ (Requirements-Driven Testing)

å–®å…ƒæ¸¬è©¦è¨ˆåŠƒä¾†è‡ªä»¥ä¸‹ä¸‰å€‹ä¾†æºï¼š

#### ğŸ“Œ ä¾†æº 1: Story Acceptance Criteria (AC)

æ¯å€‹ User Story çš„é©—æ”¶æ¨™æº–ç›´æ¥è½‰åŒ–ç‚ºæ¸¬è©¦æ¡ˆä¾‹ã€‚

**ç¯„ä¾‹ï¼šStory 2.1 å»ºç«‹è®€æ›¸æœƒ**

```yaml
Story: 2.1 å»ºç«‹è®€æ›¸æœƒ
Acceptance Criteria:
  AC1: ç”¨æˆ¶å¯ä»¥è¨­å®šè®€æ›¸æœƒåç¨±ï¼ˆå¿…å¡«ï¼Œ50å­—å…ƒå…§ï¼‰
    â†’ test_create_book_club_success()
    â†’ test_create_book_club_name_too_long()
    â†’ test_create_book_club_name_empty()
  
  AC2: å»ºç«‹è€…è‡ªå‹•æˆç‚ºæ“æœ‰è€…
    â†’ test_owner_automatically_becomes_member()
    â†’ test_owner_role_is_correct()
  
  AC3: éœ€è¦è¨­å®šè‡³å°‘ä¸€å€‹ä¸»é¡Œæ¨™ç±¤
    â†’ test_create_book_club_no_tags()
    â†’ test_create_book_club_with_invalid_tag_ids()
```

#### ğŸ“Œ ä¾†æº 2: æ¨¡çµ„çµæ§‹å°æ‡‰ (Module-Based)

æ¯å€‹ç¨‹å¼ç¢¼æ¨¡çµ„å°æ‡‰ä¸€å€‹æ¸¬è©¦æª”æ¡ˆï¼š

| ç¨‹å¼ç¢¼æ¨¡çµ„ | æ¸¬è©¦æª”æ¡ˆ | æ¸¬è©¦é‡é» |
|-----------|---------|---------|
| `app/services/book_club_service.py` | `tests/unit/test_book_club_service.py` | Service å±¤å•†æ¥­é‚è¼¯ |
| `app/services/event_service.py` | `tests/unit/test_event_service.py` | æ´»å‹•ç®¡ç†é‚è¼¯ |
| `app/services/user_service.py` | `tests/unit/test_user_service.py` | ç”¨æˆ¶ç®¡ç†é‚è¼¯ |
| `app/models/book_club.py` | Schema é©—è­‰æ¸¬è©¦ | Pydantic é©—è­‰ |

#### ğŸ“Œ ä¾†æº 3: é¢¨éšªå°å‘æ¸¬è©¦ (Risk-Based)

é‡å°é«˜é¢¨éšªå€åŸŸè¨­è¨ˆé¡å¤–æ¸¬è©¦ï¼š

- **å®‰å…¨æ€§**: å¯†ç¢¼é›œæ¹Šã€Token é©—è­‰ã€æ¬Šé™æª¢æŸ¥
- **è³‡æ–™å®Œæ•´æ€§**: é‡è¤‡ Emailã€å¤–éµç´„æŸã€äº¤æ˜“ä¸€è‡´æ€§
- **é‚Šç•Œæ¢ä»¶**: å­—ä¸²é•·åº¦é™åˆ¶ã€æ•¸å­—ç¯„åœã€ç©ºå€¼è™•ç†
- **éŒ¯èª¤è™•ç†**: ç•°å¸¸æ•ç²ã€éŒ¯èª¤è¨Šæ¯ã€HTTP ç‹€æ…‹ç¢¼

---

## 3. æ¸¬è©¦æ¡ˆä¾‹ç”Ÿæˆæµç¨‹

### 3.1 å®Œæ•´ç”Ÿæˆæµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: éœ€æ±‚åˆ†æ (Requirements Analysis)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ é–±è®€ PRD èˆ‡ Story æ–‡ä»¶                                     â”‚
â”‚ â€¢ è­˜åˆ¥ Acceptance Criteria (AC)                             â”‚
â”‚ â€¢ æ¨™è¨˜é—œéµæ¥­å‹™é‚è¼¯èˆ‡é¢¨éšªå€åŸŸ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: æ¸¬è©¦å ´æ™¯è¨­è¨ˆ (Test Scenario Design)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ­£å¸¸æµç¨‹ (Happy Path)                                     â”‚
â”‚ â€¢ éŒ¯èª¤è™•ç† (Error Handling)                                 â”‚
â”‚ â€¢ é‚Šç•Œæ¢ä»¶ (Boundary Conditions)                            â”‚
â”‚ â€¢ ç•°å¸¸æƒ…å¢ƒ (Exception Cases)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: æ¸¬è©¦å±¤ç´šåˆ†é… (Test Level Assignment)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Unit Test:     Service å±¤é‚è¼¯ã€Model é©—è­‰ã€å·¥å…·å‡½æ•¸         â”‚
â”‚ Integration:   API ç«¯é»ã€è³‡æ–™åº«æ“ä½œã€å¤–éƒ¨æœå‹™æ•´åˆ           â”‚
â”‚ E2E Test:      å®Œæ•´ç”¨æˆ¶æµç¨‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: æ¸¬è©¦æ¡ˆä¾‹å¯¦ä½œ (Test Implementation)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ä½¿ç”¨ AAA æ¨¡å¼ (Arrange-Act-Assert)                        â”‚
â”‚ â€¢ ä½¿ç”¨ Pytest Fixtures ç®¡ç†æ¸¬è©¦è³‡æ–™                         â”‚
â”‚ â€¢ éµå¾ªå‘½åè¦ç¯„: test_<function>_<scenario>()               â”‚
â”‚ â€¢ æ’°å¯«æ¸…æ™°çš„æ¸¬è©¦æ–‡æª”å­—ä¸²                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: è¦†è“‹ç‡é©—è­‰ (Coverage Verification)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ åŸ·è¡Œ pytest --cov=app --cov-report=html                   â”‚
â”‚ â€¢ æª¢æŸ¥å„æ¨¡çµ„è¦†è“‹ç‡æ˜¯å¦é”æ¨™ (â‰¥ 80%)                          â”‚
â”‚ â€¢ è­˜åˆ¥æœªè¦†è“‹çš„ç¨‹å¼ç¢¼å€å¡Š                                     â”‚
â”‚ â€¢ è£œå……ç¼ºå¤±çš„æ¸¬è©¦æ¡ˆä¾‹                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 AAA æ¸¬è©¦æ¨¡å¼ç¯„ä¾‹

æ‰€æœ‰å–®å…ƒæ¸¬è©¦éµå¾ª **AAA æ¨¡å¼** (Arrange-Act-Assert)ï¼š

```python
def test_create_book_club_success(session: Session, test_user: User):
    """æ¸¬è©¦æˆåŠŸå»ºç«‹è®€æ›¸æœƒ"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Arrange (æº–å‚™): è¨­å®šæ¸¬è©¦è³‡æ–™èˆ‡ç’°å¢ƒ
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    tag1 = ClubTag(name="æ–‡å­¸", is_predefined=True)
    tag2 = ClubTag(name="ç§‘æŠ€", is_predefined=True)
    session.add_all([tag1, tag2])
    session.commit()
    
    book_club_data = BookClubCreate(
        name="Python è®€æ›¸æœƒ",
        description="ä¸€èµ·å­¸ç¿’ Python",
        visibility=BookClubVisibility.PUBLIC,
        tag_ids=[tag1.id, tag2.id]
    )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Act (åŸ·è¡Œ): èª¿ç”¨è¢«æ¸¬è©¦çš„å‡½æ•¸
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    result = book_club_service.create_book_club(
        session=session,
        current_user=test_user,
        book_club_data=book_club_data
    )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Assert (é©—è­‰): æª¢æŸ¥çµæœæ˜¯å¦ç¬¦åˆé æœŸ
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    assert result.id is not None
    assert result.name == "Python è®€æ›¸æœƒ"
    assert result.owner_id == test_user.id
    assert len(result.tags) == 2
```

---

## 4. æ¸¬è©¦æ¨¡å‹èªªæ˜

### 4.1 æ¡ç”¨ç™½ç®±æ¸¬è©¦ (White Box Testing)

**å®šç¾©**: æ¸¬è©¦è€…å®Œå…¨äº†è§£ç¨‹å¼ç¢¼å…§éƒ¨çµæ§‹ã€é‚è¼¯è·¯å¾‘ã€è³‡æ–™æµå‹•ã€‚

### 4.2 ç™½ç®±æ¸¬è©¦ç‰¹å¾µ

#### âœ… **1. æ¸¬è©¦å…§éƒ¨å¯¦ä½œç´°ç¯€**

```python
def test_create_book_club_success(session: Session, test_user: User):
    result = book_club_service.create_book_club(...)
    
    # é©—è­‰å…§éƒ¨è³‡æ–™é—œè¯
    assert result.owner_id == test_user.id  # â† çŸ¥é“å…§éƒ¨å¦‚ä½•è¨­å®š owner_id
    assert result.member_count == 1         # â† çŸ¥é“å…§éƒ¨å¦‚ä½•è¨ˆç®—æˆå“¡æ•¸
    
    # é©—è­‰è³‡æ–™åº«ç‹€æ…‹
    member = session.exec(
        select(BookClubMember).where(BookClubMember.book_club_id == result.id)
    ).first()
    assert member.role == MemberRole.OWNER  # â† ç›´æ¥æª¢æŸ¥ DB è¨˜éŒ„
```

#### âœ… **2. ç›´æ¥æ¸¬è©¦ Service å±¤å‡½æ•¸**

ä¸é€é API ç«¯é»ï¼Œç›´æ¥èª¿ç”¨å…§éƒ¨å‡½æ•¸ï¼š

```python
# âŒ é»‘ç®±æ¸¬è©¦æœƒé€™æ¨£å¯«ï¼ˆé€é APIï¼‰
response = client.post("/api/v1/clubs", json={...})

# âœ… ç™½ç®±æ¸¬è©¦é€™æ¨£å¯«ï¼ˆç›´æ¥èª¿ç”¨ Serviceï¼‰
result = book_club_service.create_book_club(session, user, data)
```

#### âœ… **3. æ¸¬è©¦æ‰€æœ‰ç¨‹å¼ç¢¼è·¯å¾‘**

ä½¿ç”¨ç¨‹å¼ç¢¼è¦†è“‹ç‡å·¥å…·è¿½è¹¤æ‰€æœ‰åˆ†æ”¯ï¼š

```python
def validate_event_datetime(event_time: datetime):
    if event_time <= datetime.utcnow():  # â† åˆ†æ”¯ A
        raise HTTPException(...)
    # åˆ†æ”¯ B (æ­£å¸¸æµç¨‹)

# æ¸¬è©¦å¿…é ˆè¦†è“‹å…©å€‹åˆ†æ”¯
def test_past_datetime_invalid():
    # æ¸¬è©¦åˆ†æ”¯ A
    with pytest.raises(HTTPException):
        validate_event_datetime(past_time)

def test_future_datetime_valid():
    # æ¸¬è©¦åˆ†æ”¯ B
    validate_event_datetime(future_time)  # ä¸æ‡‰æ‹‹å‡ºç•°å¸¸
```

#### âœ… **4. æ¸¬è©¦å…§éƒ¨é©—è­‰é‚è¼¯**

```python
class TestValidateMeetingUrl:
    """æ¸¬è©¦æœƒè­° URL é©—è­‰ï¼ˆç™½ç®±æ¸¬è©¦ï¼šçŸ¥é“å…§éƒ¨é©—è­‰é‚è¼¯ï¼‰"""
    
    def test_valid_https_google_meet(self):
        # çŸ¥é“å…§éƒ¨æ¥å— HTTPS URL
        url = "https://meet.google.com/abc-defg-hij"
        validate_meeting_url(url)  # ä¸æ‡‰æ‹‹å‡ºç•°å¸¸
    
    def test_invalid_http_url(self):
        # çŸ¥é“å…§éƒ¨æœƒæ‹’çµ• HTTP URL
        url = "http://meet.google.com/abc"
        with pytest.raises(HTTPException) as exc:
            validate_meeting_url(url)
        assert "HTTPS" in exc.value.detail
```

### 4.3 ç™½ç®±æ¸¬è©¦ vs é»‘ç®±æ¸¬è©¦å°æ¯”

| ç‰¹å¾µ | é»‘ç®±æ¸¬è©¦ | **ç™½ç®±æ¸¬è©¦ï¼ˆæœ¬å°ˆæ¡ˆï¼‰** |
|------|---------|---------------------|
| **å…§éƒ¨çµæ§‹çŸ¥è­˜** | âŒ ä¸éœ€è¦ | âœ… å®Œå…¨äº†è§£ |
| **æ¸¬è©¦å°è±¡** | è¼¸å…¥ â†’ è¼¸å‡º | å…§éƒ¨å‡½æ•¸ã€é‚è¼¯è·¯å¾‘ |
| **æ¸¬è©¦ä¾æ“š** | éœ€æ±‚è¦æ ¼ | ç¨‹å¼ç¢¼çµæ§‹ + éœ€æ±‚ |
| **è¦†è“‹ç‡é¡å‹** | åŠŸèƒ½è¦†è“‹ | **ç¨‹å¼ç¢¼è¡Œè¦†è“‹ç‡** |
| **æ¸¬è©¦å±¤ç´š** | ç³»çµ±å±¤ç´š | **å–®å…ƒå±¤ç´š** |
| **æ¸¬è©¦æŠ€è¡“** | ç­‰åƒ¹é¡åŠƒåˆ† | è·¯å¾‘è¦†è“‹ã€åˆ†æ”¯è¦†è“‹ |
| **ç¯„ä¾‹å·¥å…·** | Postman, Selenium | **pytest, coverage.py** |

### 4.4 ç™½ç®±æ¸¬è©¦è¦†è“‹æŠ€è¡“

æœ¬å°ˆæ¡ˆä½¿ç”¨ä»¥ä¸‹ç™½ç®±æ¸¬è©¦è¦†è“‹æŠ€è¡“ï¼š

#### 1ï¸âƒ£ **èªå¥è¦†è“‹ (Statement Coverage)**
- ç¢ºä¿æ¯ä¸€è¡Œç¨‹å¼ç¢¼è‡³å°‘åŸ·è¡Œä¸€æ¬¡
- ç•¶å‰é”æˆç‡ï¼š84.40%

#### 2ï¸âƒ£ **åˆ†æ”¯è¦†è“‹ (Branch Coverage)**
- ç¢ºä¿æ‰€æœ‰ if/else åˆ†æ”¯éƒ½è¢«æ¸¬è©¦
```python
# éœ€è¦æ¸¬è©¦å…©å€‹åˆ†æ”¯
if cover_image:
    upload_image()  # â† åˆ†æ”¯ 1
else:
    pass            # â† åˆ†æ”¯ 2
```

#### 3ï¸âƒ£ **è·¯å¾‘è¦†è“‹ (Path Coverage)**
- æ¸¬è©¦ç¨‹å¼åŸ·è¡Œçš„ä¸åŒè·¯å¾‘çµ„åˆ
```python
# æ¸¬è©¦ä¸åŒåƒæ•¸çµ„åˆçš„åŸ·è¡Œè·¯å¾‘
test_create_with_cover_and_tags()
test_create_without_cover_but_with_tags()
test_create_with_minimal_data()
```

#### 4ï¸âƒ£ **é‚Šç•Œå€¼æ¸¬è©¦ (Boundary Value Testing)**
```python
def test_name_exactly_50_chars():  # é‚Šç•Œå€¼
    name = "A" * 50
    # æ‡‰è©²æˆåŠŸ
    
def test_name_51_chars():  # è¶…éé‚Šç•Œ
    name = "A" * 51
    # æ‡‰è©²å¤±æ•—
```

---

## 5. è¦†è“‹ç‡è¨ˆç®—æ–¹æ³•

### 5.1 è¦†è“‹ç‡å®šç¾©

```
ç¨‹å¼ç¢¼è¦†è“‹ç‡ = (è¢«æ¸¬è©¦åŸ·è¡Œéçš„ç¨‹å¼ç¢¼è¡Œæ•¸) / (ç¸½ç¨‹å¼ç¢¼è¡Œæ•¸) Ã— 100%
```

**é‡è¦**: è¦†è“‹ç‡ â‰  æ¸¬è©¦é€šéç‡

- **è¦†è“‹ç‡ 84.44%** = 1,991 è¡Œå·²è¦†è“‹ Ã· 2,358 è¡Œç¸½ç¨‹å¼ç¢¼
- **æ¸¬è©¦é€šéç‡ 100%** = 103 å€‹å–®å…ƒæ¸¬è©¦å…¨éƒ¨é€šé Ã· 103 å€‹ç¸½æ¸¬è©¦

### 5.2 è¦†è“‹ç‡è¨ˆç®—å·¥å…·éˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pytest       â”‚ â† æ¸¬è©¦åŸ·è¡Œå™¨
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pytest-cov   â”‚ â† pytest è¦†è“‹ç‡æ’ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ coverage.py  â”‚ â† åº•å±¤è¦†è“‹ç‡è¿½è¹¤å¼•æ“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸ·è¡Œæ™‚è¿½è¹¤                        â”‚
â”‚ â€¢ è¨˜éŒ„å“ªäº›ç¨‹å¼ç¢¼è¡Œè¢«åŸ·è¡Œ            â”‚
â”‚ â€¢ è¨˜éŒ„å“ªäº›åˆ†æ”¯è¢«èµ°é                â”‚
â”‚ â€¢ ç”Ÿæˆ .coverage è³‡æ–™åº«æª”æ¡ˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆå ±å‘Š                          â”‚
â”‚ â€¢ coverage.json (åŸå§‹æ•¸æ“š)        â”‚
â”‚ â€¢ htmlcov/index.html (è¦–è¦ºåŒ–)    â”‚
â”‚ â€¢ coverage_report_zh_TW.txt      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 è¦†è“‹ç‡è¨ˆç®—ç¯„ä¾‹

#### ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š`book_club_service.py`

```python
def create_book_club(session, user, data, cover_image=None):
    # Line 1: é©—è­‰æ¨™ç±¤
    tags = session.exec(select(ClubTag).where(...)).all()  # âœ… å·²è¦†è“‹
    
    # Line 2: éŒ¯èª¤è™•ç†
    if len(tags) != len(data.tag_ids):  # âœ… å·²è¦†è“‹
        raise HTTPException(...)         # âœ… å·²è¦†è“‹
    
    # Line 3: å»ºç«‹è®€æ›¸æœƒ
    club = BookClub(name=data.name, ...)  # âœ… å·²è¦†è“‹
    session.add(club)                     # âœ… å·²è¦†è“‹
    session.flush()                       # âœ… å·²è¦†è“‹
    
    # Line 4: è™•ç†å°é¢ï¼ˆåˆ†æ”¯ï¼‰
    if cover_image:                       # âœ… å·²è¦†è“‹ï¼ˆTrue åˆ†æ”¯ï¼‰
        upload_image()                    # âŒ æœªè¦†è“‹ï¼ˆåœ–ç‰‡ä¸Šå‚³å»¶å¾Œå¯¦ä½œï¼‰
    else:                                 # âœ… å·²è¦†è“‹ï¼ˆFalse åˆ†æ”¯ï¼‰
        pass                              # âœ… å·²è¦†è“‹
    
    # Line 5: å»ºç«‹æˆå“¡è¨˜éŒ„
    member = BookClubMember(...)          # âœ… å·²è¦†è“‹
    session.add(member)                   # âœ… å·²è¦†è“‹
    session.commit()                      # âœ… å·²è¦†è“‹
```

**è¦†è“‹ç‡è¨ˆç®—**:
- ç¸½è¡Œæ•¸: 12 è¡Œ
- å·²è¦†è“‹: 11 è¡Œ
- æœªè¦†è“‹: 1 è¡Œ (`upload_image()`)
- è¦†è“‹ç‡: 11 Ã· 12 = **91.67%**

### 5.4 å„æ¨¡çµ„è¦†è“‹ç‡çµ±è¨ˆ

| æ¨¡çµ„ | æª”æ¡ˆæ•¸ | ç¸½è¡Œæ•¸ | å·²è¦†è“‹ | æœªè¦†è“‹ | è¦†è“‹ç‡ |
|------|--------|--------|--------|--------|--------|
| **schemas** | 8 | 307 | 297 | 10 | **96.74%** â­ |
| **models** | 11 | 588 | 567 | 21 | **96.42%** â­ |
| **api** | 13 | 485 | 396 | 89 | **81.65%** âœ… |
| **services** | 13 | 662 | 533 | 129 | **80.55%** âœ… |
| **core** | 6 | 199 | 159 | 40 | **79.90%** âš ï¸ |
| **æ•´é«”** | **55** | **2,353** | **1,986** | **367** | **84.40%** âœ… |

### 5.5 è¦†è“‹ç‡è¿½è¹¤æŒ‡ä»¤

```bash
# åŸ·è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
docker-compose exec api pytest --cov=app --cov-report=html --cov-report=json -v

# ç”Ÿæˆä¸­æ–‡å ±å‘Š
docker-compose exec api python generate_coverage_report.py

# æŸ¥çœ‹ HTML å ±å‘Šï¼ˆé€è¡Œè¦†è“‹ç‡è¦–è¦ºåŒ–ï¼‰
open backend/htmlcov/index.html
```

---

## 6. æ¸¬è©¦çµæ§‹èˆ‡çµ„ç¹”

### 6.1 æ¸¬è©¦ç›®éŒ„çµæ§‹

```
backend/tests/
â”œâ”€â”€ conftest.py                      # å…±ç”¨ Pytest Fixtures
â”œâ”€â”€ unit/                            # å–®å…ƒæ¸¬è©¦ç›®éŒ„
â”‚   â”œâ”€â”€ test_book_club_service.py    # è®€æ›¸æœƒæœå‹™æ¸¬è©¦
â”‚   â”œâ”€â”€ test_event_service.py        # æ´»å‹•æœå‹™æ¸¬è©¦
â”‚   â”œâ”€â”€ test_user_service.py         # ç”¨æˆ¶æœå‹™æ¸¬è©¦
â”‚   â”œâ”€â”€ test_email_service.py        # éƒµä»¶æœå‹™æ¸¬è©¦
â”‚   â”œâ”€â”€ test_password_reset_service.py
â”‚   â”œâ”€â”€ test_notification_service.py
â”‚   â”œâ”€â”€ test_interest_tag_service.py
â”‚   â”œâ”€â”€ test_user_profile_service.py
â”‚   â”œâ”€â”€ test_dashboard_service.py
â”‚   â”œâ”€â”€ test_discussion_service.py
â”‚   â”œâ”€â”€ test_user_event_service.py
â”‚   â”œâ”€â”€ test_event_participation.py
â”‚   â”œâ”€â”€ test_event_update_delete.py
â”‚   â”œâ”€â”€ test_book_club_list_service.py
â”‚   â”œâ”€â”€ test_avatar_upload.py
â”‚   â”œâ”€â”€ test_user_model.py
â”‚   â””â”€â”€ test_notifications_api.py
â””â”€â”€ integration/                     # æ•´åˆæ¸¬è©¦ç›®éŒ„ï¼ˆå¦å¤–æ–‡ä»¶èªªæ˜ï¼‰
    â””â”€â”€ ...
```

### 6.2 Pytest Fixtures è¨­è¨ˆ

**æª”æ¡ˆ**: `backend/tests/conftest.py`

#### Fixture 1: æ¸¬è©¦è³‡æ–™åº« Session

```python
@pytest.fixture(name="session")
def session_fixture() -> Generator[Session, Any, None]:
    """å»ºç«‹ in-memory SQLite æ¸¬è©¦è³‡æ–™åº«"""
    engine = create_engine(
        "sqlite://",  # â† in-memoryï¼Œé€Ÿåº¦å¿«ï¼Œéš”é›¢æ€§å¥½
        connect_args={"check_same_thread": False},
        poolclass=StaticPool
    )
    SQLModel.metadata.create_all(engine)  # å»ºç«‹æ‰€æœ‰ Table
    with Session(engine) as session:
        yield session
    SQLModel.metadata.drop_all(engine)    # æ¸…ç†è³‡æ–™
```

**å„ªé»**:
- âœ… å¿«é€Ÿï¼šè¨˜æ†¶é«”è³‡æ–™åº«ï¼Œç„¡ I/O å»¶é²
- âœ… éš”é›¢ï¼šæ¯å€‹æ¸¬è©¦ç¨ç«‹çš„è³‡æ–™åº«
- âœ… ä¹¾æ·¨ï¼šæ¸¬è©¦å¾Œè‡ªå‹•éŠ·æ¯€

#### Fixture 2: æ¸¬è©¦ç”¨æˆ¶

```python
@pytest.fixture(name="test_user")
def test_user_fixture(session: Session) -> User:
    """å»ºç«‹æ¸¬è©¦ç”¨æˆ¶ï¼ˆå¯†ç¢¼å·²é›œæ¹Šï¼‰"""
    from app.core.security import hash_password
    user = User(
        email="test@example.com",
        display_name="Test User",
        password_hash=hash_password("TestPassword123"),
        email_verified=True
    )
    session.add(user)
    session.commit()
    session.refresh(user)
    return user
```

#### Fixture 3: å¦ä¸€å€‹ç”¨æˆ¶ï¼ˆç”¨æ–¼å¤šç”¨æˆ¶å ´æ™¯ï¼‰

```python
@pytest.fixture(name="another_user")
def another_user_fixture(session: Session) -> User:
    """å»ºç«‹ç¬¬äºŒå€‹æ¸¬è©¦ç”¨æˆ¶"""
    # ç”¨æ–¼æ¸¬è©¦ï¼šåŠ å…¥ä»–äººçš„è®€æ›¸æœƒã€äº’å‹•ç­‰å ´æ™¯
    ...
```

### 6.3 æ¸¬è©¦æª”æ¡ˆå‘½åè¦ç¯„

| è¦ç¯„ | ç¯„ä¾‹ | èªªæ˜ |
|------|------|------|
| æª”æ¡ˆåç¨± | `test_<module_name>.py` | ä»¥ `test_` é–‹é ­ |
| æ¸¬è©¦å‡½æ•¸ | `test_<function>_<scenario>()` | æ¸…æ¥šæè¿°æ¸¬è©¦å ´æ™¯ |
| æ¸¬è©¦é¡åˆ¥ | `class TestValidateEventDatetime:` | åˆ†çµ„ç›¸é—œæ¸¬è©¦ |
| æ–‡æª”å­—ä¸² | `"""æ¸¬è©¦æˆåŠŸå»ºç«‹è®€æ›¸æœƒ""" ` | ä¸­æ–‡èªªæ˜æ¸¬è©¦ç›®çš„ |

**ç¯„ä¾‹**:

```python
# âœ… å¥½çš„å‘½å
def test_create_book_club_success():
    """æ¸¬è©¦æˆåŠŸå»ºç«‹è®€æ›¸æœƒ"""
    ...

def test_create_book_club_with_invalid_tag_ids():
    """æ¸¬è©¦ä½¿ç”¨ç„¡æ•ˆçš„æ¨™ç±¤ ID å»ºç«‹è®€æ›¸æœƒ"""
    ...

# âŒ ä¸å¥½çš„å‘½å
def test1():
    ...

def test_club():
    ...
```

---

## 7. å–®å…ƒæ¸¬è©¦æ¸…å–®

### 7.1 ä¾æ¨¡çµ„åˆ†é¡çš„æ¸¬è©¦æ¸…å–®

#### ğŸ“¦ Services æ¨¡çµ„ï¼ˆ13 å€‹æ¸¬è©¦æª”æ¡ˆï¼‰

##### `test_book_club_service.py` (7 å€‹æ¸¬è©¦)

| æ¸¬è©¦æ¡ˆä¾‹ | æ¸¬è©¦å ´æ™¯ | å°æ‡‰ AC |
|---------|---------|---------|
| `test_create_book_club_success` | æˆåŠŸå»ºç«‹è®€æ›¸æœƒ | Story 2.1 AC1-4 |
| `test_create_book_club_with_invalid_tag_ids` | ç„¡æ•ˆæ¨™ç±¤ ID éŒ¯èª¤è™•ç† | Story 2.1 AC4 |
| `test_create_book_club_name_too_long` | åç¨±é•·åº¦é©—è­‰ï¼ˆ51å­—å…ƒï¼‰ | Story 2.1 AC1 |
| `test_create_book_club_description_too_long` | ç°¡ä»‹é•·åº¦é©—è­‰ï¼ˆ501å­—å…ƒï¼‰ | Story 2.1 AC1 |
| `test_create_book_club_no_tags` | ç¼ºå°‘æ¨™ç±¤é©—è­‰ | Story 2.1 AC4 |
| `test_get_available_tags` | å–å¾—å¯ç”¨æ¨™ç±¤åˆ—è¡¨ | Story 2.1 AC4 |
| `test_create_private_book_club` | å»ºç«‹ç§å¯†è®€æ›¸æœƒ | Story 2.1 AC2 |

##### `test_event_service.py` (12 å€‹æ¸¬è©¦)

**é©—è­‰å‡½æ•¸æ¸¬è©¦**:
| æ¸¬è©¦æ¡ˆä¾‹ | æ¸¬è©¦å ´æ™¯ |
|---------|---------|
| `test_future_datetime_valid` | æœªä¾†æ™‚é–“é©—è­‰é€šé |
| `test_past_datetime_invalid` | éå»æ™‚é–“é©—è­‰å¤±æ•— |
| `test_current_datetime_invalid` | ç•¶å‰æ™‚é–“é©—è­‰å¤±æ•— |
| `test_valid_https_google_meet` | Google Meet URL é©—è­‰ |
| `test_valid_https_zoom` | Zoom URL é©—è­‰ |
| `test_invalid_http_url` | HTTP URL æ‹’çµ• |
| `test_invalid_url_format` | ç„¡æ•ˆ URL æ ¼å¼ |

**å»ºç«‹æ´»å‹•æ¸¬è©¦**:
| æ¸¬è©¦æ¡ˆä¾‹ | æ¸¬è©¦å ´æ™¯ |
|---------|---------|
| `test_create_event_success` | æˆåŠŸå»ºç«‹æ´»å‹• |
| `test_create_event_not_admin` | éç®¡ç†å“¡ç„¡æ³•å»ºç«‹ |
| `test_create_event_invalid_datetime` | ç„¡æ•ˆæ™‚é–“æ‹’çµ• |
| `test_create_event_invalid_url` | ç„¡æ•ˆ URL æ‹’çµ• |
| `test_create_event_exceed_max_participants` | äººæ•¸é™åˆ¶é©—è­‰ |

##### `test_user_service.py` (8 å€‹æ¸¬è©¦)

| æ¸¬è©¦æ¡ˆä¾‹ | æ¸¬è©¦å ´æ™¯ | å°æ‡‰åŠŸèƒ½ |
|---------|---------|---------|
| `test_create_user_success` | æˆåŠŸå»ºç«‹ç”¨æˆ¶ | è¨»å†ŠåŠŸèƒ½ |
| `test_create_user_duplicate_email` | é‡è¤‡ Email éŒ¯èª¤ | è³‡æ–™å”¯ä¸€æ€§ |
| `test_create_user_password_hashing` | å¯†ç¢¼é›œæ¹Šé©—è­‰ | å®‰å…¨æ€§ |
| `test_authenticate_user_success` | æˆåŠŸèªè­‰ | ç™»å…¥åŠŸèƒ½ |
| `test_authenticate_user_wrong_password` | éŒ¯èª¤å¯†ç¢¼ | ç™»å…¥å®‰å…¨ |
| `test_authenticate_user_not_found` | ç”¨æˆ¶ä¸å­˜åœ¨ | éŒ¯èª¤è™•ç† |
| `test_update_user_profile` | æ›´æ–°å€‹äººæª”æ¡ˆ | æª”æ¡ˆç®¡ç† |
| `test_verify_email` | Email é©—è­‰ | å¸³è™Ÿå•Ÿç”¨ |

##### `test_password_reset_service.py` (6 å€‹æ¸¬è©¦)

| æ¸¬è©¦æ¡ˆä¾‹ | æ¸¬è©¦å ´æ™¯ |
|---------|---------|
| `test_generate_reset_token` | ç”Ÿæˆé‡ç½® Token |
| `test_reset_token_expiry` | Token éæœŸæª¢æŸ¥ |
| `test_reset_password_success` | æˆåŠŸé‡ç½®å¯†ç¢¼ |
| `test_reset_password_invalid_token` | ç„¡æ•ˆ Token æ‹’çµ• |
| `test_reset_password_expired_token` | éæœŸ Token æ‹’çµ• |
| `test_reset_password_token_one_time_use` | Token å–®æ¬¡ä½¿ç”¨ |

##### `test_email_service.py` (5 å€‹æ¸¬è©¦)

| æ¸¬è©¦æ¡ˆä¾‹ | æ¸¬è©¦å ´æ™¯ |
|---------|---------|
| `test_send_verification_email` | ç™¼é€é©—è­‰éƒµä»¶ï¼ˆMockï¼‰ |
| `test_send_password_reset_email` | ç™¼é€é‡ç½®éƒµä»¶ï¼ˆMockï¼‰ |
| `test_send_welcome_email` | ç™¼é€æ­¡è¿éƒµä»¶ï¼ˆMockï¼‰ |
| `test_email_template_rendering` | éƒµä»¶æ¨¡æ¿æ¸²æŸ“ |
| `test_email_send_failure_handling` | ç™¼é€å¤±æ•—è™•ç† |

##### å…¶ä»– Services æ¸¬è©¦æª”æ¡ˆ

- `test_notification_service.py` - é€šçŸ¥é‚è¼¯æ¸¬è©¦
- `test_interest_tag_service.py` - èˆˆè¶£æ¨™ç±¤æ¸¬è©¦
- `test_user_profile_service.py` - ç”¨æˆ¶æª”æ¡ˆæœå‹™æ¸¬è©¦
- `test_dashboard_service.py` - å„€è¡¨æ¿æœå‹™æ¸¬è©¦
- `test_discussion_service.py` - è¨è«–å€æœå‹™æ¸¬è©¦
- `test_user_event_service.py` - ç”¨æˆ¶æ´»å‹•æœå‹™æ¸¬è©¦
- `test_event_participation.py` - æ´»å‹•åƒèˆ‡é‚è¼¯æ¸¬è©¦
- `test_event_update_delete.py` - æ´»å‹•æ›´æ–°åˆªé™¤æ¸¬è©¦

#### ğŸ“¦ Models æ¨¡çµ„æ¸¬è©¦

##### `test_user_model.py` (Schema é©—è­‰æ¸¬è©¦)

| æ¸¬è©¦æ¡ˆä¾‹ | æ¸¬è©¦å ´æ™¯ |
|---------|---------|
| `test_user_create_schema_valid` | æœ‰æ•ˆç”¨æˆ¶å»ºç«‹è³‡æ–™ |
| `test_user_create_invalid_email` | ç„¡æ•ˆ Email æ ¼å¼ |
| `test_user_create_weak_password` | å¼±å¯†ç¢¼æ‹’çµ• |
| `test_user_create_missing_display_name` | ç¼ºå°‘é¡¯ç¤ºåç¨± |
| `test_user_read_schema_camelcase` | camelCase è½‰æ› |

#### ğŸ“¦ Core æ¨¡çµ„æ¸¬è©¦

æ¸¬è©¦æª”æ¡ˆåµŒå…¥åœ¨å„ service æ¸¬è©¦ä¸­ï¼š

- Security æ¸¬è©¦ï¼ˆå¯†ç¢¼é›œæ¹Šã€Token ç”Ÿæˆï¼‰
- Permissions æ¸¬è©¦ï¼ˆæ¬Šé™æª¢æŸ¥é‚è¼¯ï¼‰
- Validation æ¸¬è©¦ï¼ˆå…±ç”¨é©—è­‰å‡½æ•¸ï¼‰

---

## 8. æ¸¬è©¦åŸ·è¡Œèˆ‡å ±å‘Š

### 8.1 æœ¬åœ°åŸ·è¡Œæ¸¬è©¦

```bash
# é€²å…¥å¾Œç«¯ç›®éŒ„
cd backend

# åŸ·è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦
docker-compose exec api pytest tests/unit/ -v

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
docker-compose exec api pytest tests/unit/test_book_club_service.py -v

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦æ¡ˆä¾‹
docker-compose exec api pytest tests/unit/test_book_club_service.py::test_create_book_club_success -v

# åŸ·è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
docker-compose exec api pytest tests/unit/ --cov=app --cov-report=html --cov-report=term -v
```

### 8.2 è¦†è“‹ç‡å ±å‘Šç”Ÿæˆ

```bash
# ç”Ÿæˆå®Œæ•´è¦†è“‹ç‡å ±å‘Šï¼ˆJSON + HTML + ä¸­æ–‡æ‘˜è¦ï¼‰
docker-compose exec api pytest --cov=app --cov-report=html --cov-report=json -v

# ç”Ÿæˆä¸­æ–‡å ±å‘Š
docker-compose exec api python generate_coverage_report.py

# æŸ¥çœ‹å ±å‘Š
cat backend/coverage_report_zh_TW.txt
open backend/htmlcov/index.html  # macOS
```

### 8.3 CI/CD æ•´åˆ

æ¸¬è©¦æœƒåœ¨ä»¥ä¸‹æ™‚æ©Ÿè‡ªå‹•åŸ·è¡Œï¼š

1. **æœ¬åœ°é–‹ç™¼**: é–‹ç™¼è€…åœ¨æäº¤å‰åŸ·è¡Œ
2. **Pull Request**: GitHub Actions è‡ªå‹•åŸ·è¡Œ
3. **Merge to Main**: åˆä½µå‰å¿…é ˆé€šéæ¸¬è©¦
4. **Nightly Build**: æ¯æ—¥å®Œæ•´æ¸¬è©¦

**GitHub Actions å·¥ä½œæµç¨‹**:

```yaml
name: Backend Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run Unit Tests
        run: |
          docker-compose exec api pytest tests/unit/ --cov=app --cov-report=xml
      - name: Upload Coverage
        uses: codecov/codecov-action@v2
```

### 8.4 æ¸¬è©¦å ±å‘Šç¯„ä¾‹

**çµ‚ç«¯è¼¸å‡º**:

```
======================== test session starts ========================
platform darwin -- Python 3.11.0, pytest-7.4.0, pluggy-1.0.0
plugins: cov-4.1.0
collected 103 items

tests/unit/test_book_club_service.py::test_create_book_club_success PASSED [  1%]
tests/unit/test_book_club_service.py::test_create_book_club_with_invalid_tag_ids PASSED [  2%]
tests/unit/test_event_service.py::test_create_event_success PASSED [  3%]
...

======================== 103 passed in 9.20s =======================

---------- coverage: platform darwin, python 3.11.0 -----------
Name                                    Stmts   Miss  Cover
-----------------------------------------------------------
app/services/book_club_service.py         186     53    71%
app/services/event_service.py             210     27    87%
app/services/user_service.py              157     37    76%
...
-----------------------------------------------------------
TOTAL                                    2353    367    84%
```

---

## 9. å“è³ªæ¨™æº–èˆ‡é–€æª»

### 9.1 è¦†è“‹ç‡é–€æª»

| å±¤ç´š | ç›®æ¨™è¦†è“‹ç‡ | ç•¶å‰é”æˆ | ç‹€æ…‹ |
|------|----------|---------|------|
| **æ•´é«”å°ˆæ¡ˆ** | â‰¥ 80% | 84.40% | âœ… é”æ¨™ |
| **Services æ¨¡çµ„** | â‰¥ 80% | 80.55% | âœ… é”æ¨™ |
| **Models æ¨¡çµ„** | â‰¥ 90% | 96.42% | â­ å„ªç§€ |
| **Schemas æ¨¡çµ„** | â‰¥ 90% | 96.74% | â­ å„ªç§€ |
| **æ ¸å¿ƒé‚è¼¯** | 100% | - | ğŸ¯ ç›®æ¨™ |

### 9.2 æ¸¬è©¦å“è³ªæ¨™æº–

#### âœ… å¿…é ˆéµå®ˆçš„æ¨™æº–

1. **æ‰€æœ‰ Service å±¤å‡½æ•¸å¿…é ˆæœ‰å–®å…ƒæ¸¬è©¦**
2. **æ‰€æœ‰ Model Schema é©—è­‰å¿…é ˆæ¸¬è©¦**
3. **æ‰€æœ‰éŒ¯èª¤è™•ç†è·¯å¾‘å¿…é ˆè¦†è“‹**
4. **æ‰€æœ‰é‚Šç•Œæ¢ä»¶å¿…é ˆæ¸¬è©¦**
5. **æ¸¬è©¦å¿…é ˆä½¿ç”¨ AAA æ¨¡å¼**
6. **æ¸¬è©¦å¿…é ˆæœ‰æ¸…æ™°çš„æ–‡æª”å­—ä¸²**
7. **æ¸¬è©¦å¿…é ˆç¨ç«‹ã€å¯é‡è¤‡åŸ·è¡Œ**

#### âš ï¸ éœ€æ”¹å–„çš„æª”æ¡ˆ

| æª”æ¡ˆ | ç•¶å‰è¦†è“‹ç‡ | ç›®æ¨™ | å„ªå…ˆç´š |
|------|----------|------|--------|
| `app/core/cloudinary_config.py` | 30.56% | 80% | ğŸ”´ é«˜ |
| `app/main.py` | 54.72% | 70% | ğŸŸ¡ ä¸­ |
| `app/services/dashboard_service.py` | 61.90% | 80% | ğŸŸ¡ ä¸­ |

### 9.3 æ¸¬è©¦å¤±æ•—è™•ç†æµç¨‹

```
æ¸¬è©¦å¤±æ•—
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æª¢æŸ¥å¤±æ•—åŸå›          â”‚
â”‚ â€¢ ç¨‹å¼ç¢¼éŒ¯èª¤ï¼Ÿ       â”‚
â”‚ â€¢ æ¸¬è©¦æ¡ˆä¾‹éŒ¯èª¤ï¼Ÿ     â”‚
â”‚ â€¢ ç’°å¢ƒå•é¡Œï¼Ÿ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿®æ­£å•é¡Œ             â”‚
â”‚ â€¢ ä¿®æ­£ç¨‹å¼ç¢¼         â”‚
â”‚ â€¢ æ›´æ–°æ¸¬è©¦           â”‚
â”‚ â€¢ ä¿®å¾©ç’°å¢ƒ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡æ–°åŸ·è¡Œæ¸¬è©¦         â”‚
â”‚ pytest tests/unit/   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
     å…¨éƒ¨é€šéï¼Ÿ
      /      \
    YES      NO
     â”‚        â”‚
     â–¼        â””â”€â†’ å›åˆ°æª¢æŸ¥å¤±æ•—åŸå› 
   æäº¤ç¨‹å¼ç¢¼
```

### 9.4 æ–°å¢åŠŸèƒ½æ¸¬è©¦æª¢æŸ¥æ¸…å–®

é–‹ç™¼æ–°åŠŸèƒ½æ™‚ï¼Œå¿…é ˆç¢ºèªï¼š

- [ ] å·²ç‚ºæ–° Service å‡½æ•¸æ’°å¯«å–®å…ƒæ¸¬è©¦
- [ ] å·²æ¸¬è©¦æ­£å¸¸æµç¨‹ï¼ˆHappy Pathï¼‰
- [ ] å·²æ¸¬è©¦éŒ¯èª¤è™•ç†æµç¨‹
- [ ] å·²æ¸¬è©¦é‚Šç•Œæ¢ä»¶
- [ ] å·²æ¸¬è©¦ Schema é©—è­‰
- [ ] æ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] å·²ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
- [ ] å·²æ›´æ–°æ¸¬è©¦æ–‡æª”ï¼ˆå¦‚éœ€è¦ï¼‰

---

## é™„éŒ„

### A. æ¸¬è©¦å·¥å…·ç‰ˆæœ¬

```
pytest==7.4.0
pytest-cov==4.1.0
coverage==7.2.7
pytest-mock==3.11.1
```

### B. åƒè€ƒæ–‡ä»¶

- [æ¸¬è©¦è¨ˆç•« v1.0](./test-plan-v1.md)
- [æ¸¬è©¦è¨­è¨ˆ Story 1.1](./assessments/1.1-test-design-20251119.md)
- [å¾Œç«¯æ¶æ§‹è¨­è¨ˆ](../architecture.md)
- [PRD v4.1](../prd/)

### C. è¯çµ¡è³‡è¨Š

- **æ¸¬è©¦è² è²¬äºº**: QA Team
- **è¦†è“‹ç‡å ±å‘Š**: `backend/coverage_report_zh_TW.txt`
- **HTML å ±å‘Š**: `backend/htmlcov/index.html`

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2025-12-17  
**ä¸‹æ¬¡å¯©æŸ¥**: 2026-01-17
