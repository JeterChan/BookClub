# Risk Profile: Story 1.3 - Google ç¤¾äº¤ç™»å…¥

**Date**: 2025-10-16  
**Reviewer**: Quinn (Test Architect)  
**Story**: 1.3 - Google ç¤¾äº¤ç™»å…¥  

---

## Executive Summary

Story 1.3 å¯¦ä½œ Google OAuth 2.0 æ•´åˆ,æ¶‰åŠèªè­‰å’Œæˆæ¬Šç­‰å®‰å…¨æ•æ„Ÿé ˜åŸŸã€‚æ•´é«”é¢¨éšªè©•ç´šç‚º **MEDIUM-HIGH**,ä¸»è¦é¢¨éšªä¾†è‡ªç¼ºå°‘æ¸¬è©¦è¦†è“‹å’Œå®‰å…¨é˜²è­·æªæ–½(rate limiting)ã€‚å·²ä¿®æ­£ä¸€å€‹é—œéµçš„å®‰å…¨æ¼æ´ã€‚

**Overall Risk Score**: **7.25/10** (CONCERNS)

---

## Risk Matrix

| Risk Category | Probability | Impact | Score | Priority |
|--------------|-------------|---------|-------|----------|
| ç¼ºå°‘æ¸¬è©¦è¦†è“‹ | High (9/10) | High (9/10) | **8.1** | P0 |
| Rate Limitingç¼ºå¤± | Medium (6/10) | High (8/10) | **7.0** | P1 |
| ç’°å¢ƒè®Šæ•¸æœªé©—è­‰ | Medium (5/10) | Medium (7/10) | **6.0** | P1 |
| Emailè¡çªè™•ç† | Low (3/10) | Medium (6/10) | **4.5** | P2 |
| åœ‹éš›åŒ–å‚µå‹™ | Low (2/10) | Low (3/10) | **2.5** | P3 |

**Score Calculation**: `(Probability Ã— Impact) / 10`

---

## Detailed Risk Analysis

### 1. ç¼ºå°‘æ¸¬è©¦è¦†è“‹ âš ï¸ HIGH RISK

**Category**: Testing / Quality Assurance  
**Score**: 8.1/10 (HIGH)

**Description**:
- å®Œå…¨ç¼ºå°‘è‡ªå‹•åŒ–æ¸¬è©¦(å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€E2Eæ¸¬è©¦)
- OAuth æµç¨‹è¤‡é›œ,æ¶‰åŠç¬¬ä¸‰æ–¹æœå‹™(Google),ç¼ºå°‘æ¸¬è©¦æœƒå¢åŠ è¿´æ­¸é¢¨éšª
- ç„¡æ³•é‡åŒ–ç¨‹å¼ç¢¼å“è³ªå’ŒåŠŸèƒ½æ­£ç¢ºæ€§

**Probability**: 9/10 (Very High)
- æ²’æœ‰æ¸¬è©¦çš„ç¨‹å¼ç¢¼æœªä¾†ä¿®æ”¹æ™‚å¹¾ä¹ä¸€å®šæœƒå¼•å…¥ bug

**Impact**: 9/10 (Very High)
- èªè­‰ç³»çµ±çš„ bug å¯èƒ½å°è‡´å®‰å…¨æ¼æ´
- å½±éŸ¿æ‰€æœ‰ä½¿ç”¨ OAuth ç™»å…¥çš„ç”¨æˆ¶
- é›£ä»¥æª¢æ¸¬è¿´æ­¸éŒ¯èª¤

**Mitigation**:
- âœ… **Immediate**: è‡³å°‘ç‚ºæ ¸å¿ƒæ¥­å‹™é‚è¼¯åŠ å…¥å–®å…ƒæ¸¬è©¦
  - `UserService.verify_google_token()`
  - `UserService.get_or_create_google_user()`
  - `UserService.link_google_account()`
  - `UserService.unlink_google_account()`
- âœ… **Short-term**: åŠ å…¥æ•´åˆæ¸¬è©¦(ä½¿ç”¨ mock Google API)
- âœ… **Long-term**: å»ºç«‹å®Œæ•´çš„æ¸¬è©¦å¥—ä»¶(åŒ…å« E2E)

**Current Status**: âŒ æœªç·©è§£

---

### 2. Rate Limiting ç¼ºå¤± ğŸ”’ MEDIUM-HIGH RISK

**Category**: Security  
**Score**: 7.0/10 (MEDIUM-HIGH)

**Description**:
- ç™»å…¥ç«¯é»(`/api/auth/login`, `/api/auth/google/login`)ç¼ºå°‘è«‹æ±‚é »ç‡é™åˆ¶
- å¯èƒ½å—åˆ°æš´åŠ›æ”»æ“Š(brute force)æˆ–è³‡æºè€—ç›¡æ”»æ“Š

**Probability**: 6/10 (Medium)
- å…¬é–‹çš„ç™»å…¥ç«¯é»æ˜¯å¸¸è¦‹çš„æ”»æ“Šç›®æ¨™
- æ²’æœ‰ rate limiting æœƒè¢«è‡ªå‹•åŒ–å·¥å…·åˆ©ç”¨

**Impact**: 8/10 (High)
- æš´åŠ›æ”»æ“Šå¯èƒ½å°è‡´å¸³è™Ÿè¢«å…¥ä¾µ
- DoS æ”»æ“Šå¯èƒ½å°è‡´æœå‹™ä¸å¯ç”¨
- è³‡æºæ¶ˆè€—(è³‡æ–™åº«æŸ¥è©¢ã€Google API å‘¼å«)

**Mitigation**:
- âœ… **Immediate**: å¯¦ä½œ rate limiting middleware
  - å»ºè­°: æ¯ IP æ¯åˆ†é˜æœ€å¤š 5 æ¬¡ç™»å…¥å˜—è©¦
  - è€ƒæ…®ä½¿ç”¨ FastAPI çš„ slowapi æˆ– redis-based rate limiting
- âœ… **Short-term**: åŠ å…¥ç›£æ§å’Œå‘Šè­¦
- âœ… **Long-term**: å¯¦ä½œ CAPTCHA (å¤šæ¬¡å¤±æ•—å¾Œ)

**Current Status**: âŒ æœªç·©è§£

---

### 3. ç’°å¢ƒè®Šæ•¸æœªé©—è­‰ âš™ï¸ MEDIUM RISK

**Category**: Configuration / Reliability  
**Score**: 6.0/10 (MEDIUM)

**Description**:
- `GOOGLE_CLIENT_ID` ç¼ºå¤±æ™‚,`verify_google_token()` éœé»˜è¿”å› None
- æ²’æœ‰åœ¨æ‡‰ç”¨å•Ÿå‹•æ™‚é©—è­‰å¿…è¦ç’°å¢ƒè®Šæ•¸
- å¯èƒ½å°è‡´é‹è¡Œæ™‚éŒ¯èª¤,é›£ä»¥èª¿è©¦

**Probability**: 5/10 (Medium)
- éƒ¨ç½²æ–°ç’°å¢ƒæˆ–æ›´æ–°é…ç½®æ™‚å®¹æ˜“éºæ¼
- é–‹ç™¼ç’°å¢ƒå’Œç”Ÿç”¢ç’°å¢ƒé…ç½®ä¸ä¸€è‡´

**Impact**: 7/10 (Medium-High)
- Google OAuth åŠŸèƒ½å®Œå…¨å¤±æ•ˆä½†æ²’æœ‰æ˜ç¢ºéŒ¯èª¤è¨Šæ¯
- ç”¨æˆ¶é«”é©—å·®(ç™»å…¥å¤±æ•—ä½†ä¸çŸ¥é“åŸå› )
- å¢åŠ èª¿è©¦æ™‚é–“

**Mitigation**:
- âœ… **Immediate**: åœ¨æ‡‰ç”¨å•Ÿå‹•æ™‚é©—è­‰ç’°å¢ƒè®Šæ•¸
  ```python
  # main.py or config.py
  required_vars = ["GOOGLE_CLIENT_ID", "SECRET_KEY", "DATABASE_URL"]
  missing = [var for var in required_vars if not os.getenv(var)]
  if missing:
      raise EnvironmentError(f"Missing required env vars: {missing}")
  ```
- âœ… **Short-term**: ä½¿ç”¨ pydantic Settings ç®¡ç†é…ç½®
- âœ… **Long-term**: å¯¦ä½œé…ç½®é©—è­‰æ¸¬è©¦

**Current Status**: âŒ æœªç·©è§£

---

### 4. Email è¡çªè™•ç†ç­–ç•¥ ğŸ‘¥ LOW-MEDIUM RISK

**Category**: Business Logic / User Experience  
**Score**: 4.5/10 (LOW-MEDIUM)

**Description**:
- ç•¶ Google email èˆ‡ç¾æœ‰å‚³çµ±è¨»å†Šå¸³è™Ÿ email ç›¸åŒæ™‚,ç›®å‰å‰µå»ºæ–°å¸³è™Ÿ
- å¯èƒ½å°è‡´åŒä¸€å€‹ email æœ‰å¤šå€‹å¸³è™Ÿ,é€ æˆç”¨æˆ¶æ··æ·†
- ä¸ç¬¦åˆä¸€èˆ¬ç”¨æˆ¶æœŸæœ›(æœŸæœ›æ˜¯åŒä¸€å€‹å¸³è™Ÿ)

**Probability**: 3/10 (Low)
- éœ€è¦ç”¨æˆ¶å…ˆç”¨å‚³çµ±æ–¹å¼è¨»å†Š,å¾ŒçºŒæ‰ç”¨ Google ç™»å…¥
- å¤šæ•¸ç”¨æˆ¶æœƒé¸æ“‡å–®ä¸€ç™»å…¥æ–¹å¼

**Impact**: 6/10 (Medium)
- ç”¨æˆ¶é«”é©—ä¸ä½³
- å¯èƒ½å°è‡´è³‡æ–™åˆ†æ•£(å…©å€‹å¸³è™Ÿçš„è³‡æ–™)
- å®¢æœæˆæœ¬å¢åŠ (ç”¨æˆ¶è©¢å•ç‚ºä½•æœ‰å…©å€‹å¸³è™Ÿ)

**Mitigation**:
- âœ… **Immediate**: åœ¨æ–‡æª”ä¸­æ˜ç¢ºèªªæ˜æ­¤è¡Œç‚º
- âœ… **Short-term**: å¯¦ä½œå¸³è™Ÿåˆä½µåŠŸèƒ½
  - é¸é …1: è‡ªå‹•ç¶å®š(éœ€è¦é¡å¤–é©—è­‰)
  - é¸é …2: æç¤ºç”¨æˆ¶é¸æ“‡(ç¶å®šæˆ–å‰µå»ºæ–°å¸³è™Ÿ)
- âœ… **Long-term**: å¯¦ä½œçµ±ä¸€çš„èº«ä»½è­˜åˆ¥ç³»çµ±

**Current Status**: âŒ æœªç·©è§£(ä½†å¯æ¥å—)

---

### 5. åœ‹éš›åŒ–å‚µå‹™ ğŸŒ LOW RISK

**Category**: Maintainability / User Experience  
**Score**: 2.5/10 (LOW)

**Description**:
- ç¨‹å¼ç¢¼ä¸­ä¸­è‹±æ–‡æ··ç”¨(è¨»è§£ä¸­æ–‡,éŒ¯èª¤è¨Šæ¯è‹±æ–‡)
- ç¼ºå°‘çµ±ä¸€çš„åœ‹éš›åŒ–æ©Ÿåˆ¶
- æœªä¾†æ”¯æ´å¤šèªè¨€æ™‚éœ€è¦å¤§é‡é‡æ§‹

**Probability**: 2/10 (Very Low)
- çŸ­æœŸå…§ä¸å½±éŸ¿åŠŸèƒ½
- ç•¶å‰ç”¨æˆ¶ç¾¤ä¸»è¦ä½¿ç”¨ä¸­æ–‡

**Impact**: 3/10 (Low)
- ç¨‹å¼ç¢¼å¯è®€æ€§ç•¥å—å½±éŸ¿
- æœªä¾†åœ‹éš›åŒ–å·¥ä½œé‡å¢åŠ 

**Mitigation**:
- âœ… **Long-term**: å¼•å…¥ i18n æ©Ÿåˆ¶
- âœ… **Long-term**: çµ±ä¸€ç¨‹å¼ç¢¼è¨»è§£èªè¨€

**Current Status**: âœ… å¯æ¥å—(ä½å„ªå…ˆç´š)

---

## Security-Specific Risks

### âœ… Mitigated Risks (å·²ç·©è§£)

1. **OAuth ç”¨æˆ¶å¯†ç¢¼ç™»å…¥æ¼æ´** - âœ… FIXED
   - **åŸå§‹é¢¨éšª**: HIGH (8/10)
   - **å•é¡Œ**: password_hash ç‚º None æ™‚å‘¼å« verify_password æœƒæ‹‹å‡º TypeError
   - **ä¿®æ­£**: æ–°å¢ password_hash æª¢æŸ¥,OAuth ç”¨æˆ¶ç„¡æ³•ä½¿ç”¨å¯†ç¢¼ç™»å…¥
   - **ä¿®æ­£æ™‚é–“**: 2025-10-16 by Quinn (QA)

### âš ï¸ Outstanding Security Risks

1. **Rate Limiting ç¼ºå¤±** - Score: 7.0/10
2. **CORS æœªé…ç½®** - Score: 5.0/10 (å¦‚éœ€å‰ç«¯æ•´åˆ)
3. **Google API éŒ¯èª¤è™•ç†** - Score: 4.0/10

---

## Performance Risks

### âœ… Low Risk Areas
- è³‡æ–™åº«ç´¢å¼•è¨­è¨ˆåˆç†
- æŸ¥è©¢æ•ˆç‡è‰¯å¥½
- Session ä½¿ç”¨é©ç•¶

### âš ï¸ Potential Bottlenecks
- **Google Token é©—è­‰** - æ¶‰åŠç¶²è·¯è«‹æ±‚,å¯èƒ½æœ‰å»¶é²
  - **Mitigation**: åŠ å…¥ timeout è¨­å®š
  - **Mitigation**: è€ƒæ…®å¿«å– Google public keys
  - **Risk Score**: 4.5/10

---

## Reliability Risks

1. **Google API å‘¼å«å¤±æ•—** - Score: 5.5/10
   - ç¼ºå°‘ retry æ©Ÿåˆ¶
   - ç¼ºå°‘ fallback ç­–ç•¥
   - ç¼ºå°‘éŒ¯èª¤ç›£æ§

2. **äº¤æ˜“ç®¡ç†ç¼ºå¤±** - Score: 4.0/10
   - å¤šå€‹ session.commit() å¯èƒ½å°è‡´ä¸ä¸€è‡´
   - å»ºè­°ä½¿ç”¨äº¤æ˜“åŒ…è£å¤šæ­¥é©Ÿæ“ä½œ

---

## Recommendations Priority Matrix

| Priority | Action | Expected Impact | Effort |
|---------|--------|-----------------|--------|
| **P0** | åŠ å…¥å–®å…ƒæ¸¬è©¦ | High | Medium |
| **P1** | å¯¦ä½œ rate limiting | High | Low |
| **P1** | ç’°å¢ƒè®Šæ•¸é©—è­‰ | Medium | Low |
| **P2** | Email è¡çªè™•ç† | Medium | Medium |
| **P2** | çµ±ä¸€éŒ¯èª¤è¨Šæ¯ | Low | Low |
| **P3** | é…ç½®ç®¡ç†æ”¹å–„ | Low | Low |
| **P3** | Google API å„ªåŒ– | Low | Medium |

---

## Risk Trend

**Current**: ğŸ“Š 7.25/10 (MEDIUM-HIGH)  
**Target**: ğŸ“‰ < 5.0/10 (MEDIUM-LOW)

**Path to Target**:
1. å®Œæˆ P0 é …ç›®: -1.5 åˆ† â†’ 5.75/10
2. å®Œæˆ P1 é …ç›®: -0.75 åˆ† â†’ 5.0/10

---

## Monitoring Recommendations

å»ºè­°ç›£æ§ä»¥ä¸‹æŒ‡æ¨™:

1. **OAuth ç™»å…¥æˆåŠŸç‡**
   - Target: > 95%
   - Alert: < 90%

2. **Google Token é©—è­‰å»¶é²**
   - Target: < 500ms (p95)
   - Alert: > 1000ms (p95)

3. **ç™»å…¥å¤±æ•—ç‡**
   - Target: < 5%
   - Alert: > 10%

4. **Rate limit è§¸ç™¼æ¬¡æ•¸**
   - Monitor: æ¯æ—¥è§¸ç™¼æ¬¡æ•¸
   - Alert: ç•°å¸¸å¢é•·

---

## Conclusion

Story 1.3 çš„æ•´é«”å¯¦ä½œå“è³ªè‰¯å¥½,ä½†å­˜åœ¨å¹¾å€‹éœ€è¦é—œæ³¨çš„é¢¨éšªé ˜åŸŸã€‚**æœ€é—œéµçš„æ˜¯ç¼ºå°‘æ¸¬è©¦è¦†è“‹**,é€™åœ¨ OAuth é€™é¡å®‰å…¨æ•æ„ŸåŠŸèƒ½ä¸­æ˜¯ä¸€å€‹é‡è¦çš„ç¼ºé™·ã€‚å»ºè­°å„ªå…ˆå®Œæˆ P0 å’Œ P1 é …ç›®,å°‡é¢¨éšªé™è‡³å¯æ¥å—ç¯„åœã€‚

å·²ä¿®æ­£çš„å®‰å…¨æ¼æ´é¡¯ç¤ºç¨‹å¼ç¢¼å¯©æŸ¥çš„åƒ¹å€¼,å»ºè­°æœªä¾†æ‰€æœ‰èªè­‰ç›¸é—œçš„ Story éƒ½é€²è¡Œé¡ä¼¼çš„æ·±åº¦å¯©æŸ¥ã€‚

---

**Reviewed By**: Quinn (Test Architect)  
**Date**: 2025-10-16  
**Next Review**: å»ºè­°åœ¨æ¸¬è©¦è£œå……å®Œæˆå¾Œé€²è¡Œå†å¯©æŸ¥
