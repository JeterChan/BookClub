# Test Design: Story 1.1 - 新用戶註冊體驗

Date: 2025-11-19
Designer: Quinn (Test Architect)

## 1. Test Strategy Overview

This document outlines the test strategy for the New User Registration feature. The approach is based on the Test Pyramid, prioritizing fast feedback through unit tests, ensuring component correctness with integration tests, and verifying the critical user path with a single E2E test.

- **Total test scenarios**: 12
- **Unit tests**: 5 (42%)
- **Integration tests**: 6 (50%)
- **E2E tests**: 1 (8%)

- **Priority distribution**: P0: 3, P1: 9, P2: 0, P3: 0

### A Note on Stress Testing
You requested stress testing for this story. Stress testing is a non-functional requirement (NFR) that assesses the system's stability under heavy load.

While this document focuses on functional tests (Unit, Integration, E2E), I strongly recommend a dedicated analysis for stress testing. You can initiate this by running the command: `*nfr-assess 1.1`.

This will allow us to properly design scenarios to test API response times under high concurrency, database connection limits, and potential memory leaks, which are outside the scope of standard functional test design.

## 2. Test Scenarios by Acceptance Criteria

### AC1: 用戶可以使用有效的 Email 地址和強密碼進行註冊 (Users can register with a valid email and strong password)

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-INT-001 | Integration | P0 | Successfully register a new user via the `POST /api/auth/register` endpoint with valid data. | This is the primary happy path and a P0 core user journey. It validates the entire backend flow from the API endpoint to the database. |
| 1.1-UNIT-001 | Unit | P1 | The `user_service.create` function correctly hashes the password using the security module. | Ensures the core security logic of password hashing is working as expected in isolation. |

### AC2: 系統會驗證 Email 格式和密碼強度要求 (System validates email format and password strength)

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-UNIT-002 | Unit | P1 | The `UserCreate` schema validator rejects invalid email formats (e.g., missing '@', no domain). | Pure validation logic that can be tested at the model level for fast feedback. |
| 1.1-UNIT-003 | Unit | P1 | The `UserCreate` schema validator rejects weak passwords (e.g., too short, no uppercase, no number). | Pure validation logic for a critical security requirement. |
| 1.1-UNIT-004 | Unit | P1 | The `UserCreate` schema validator accepts various valid email formats. | Ensures the validation logic is not overly restrictive. |
| 1.1-UNIT-005 | Unit | P1 | The `UserCreate` schema validator accepts passwords that meet the minimum criteria exactly. | Edge case testing for the validation logic. |
| 1.1-INT-002 | Integration | P1 | The API returns a 422 Unprocessable Entity error when the registration request contains an invalid email format. | Verifies that schema validation errors are correctly propagated to the API response. |
| 1.1-INT-003 | Integration | P1 | The API returns a 422 Unprocessable Entity error when the request contains a weak password. | Verifies API-level error handling for security requirements. |

### AC3: 用戶需要提供顯示名稱作為平台識別 (User needs to provide a display name)

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-INT-004 | Integration | P1 | The API returns a 422 Unprocessable Entity error if the `display_name` field is missing from the request. | Validates that required fields are enforced at the API level. |

### AC4: 註冊成功後自動登入並導向歡迎頁面 (Successful registration leads to auto-login and redirection)

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-E2E-001 | E2E | P1 | A user fills out the registration form on the UI, submits it, and is redirected to the welcome page, showing their display name. | This is a critical user journey that can only be fully validated in a browser environment, ensuring the frontend and backend are correctly integrated. |

### AC5: 重複 Email 註冊會顯示友善的錯誤提示 (Duplicate email registration shows a friendly error)

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-INT-005 | Integration | P0 | The `user_service.create` function raises a specific exception when trying to create a user with an email that already exists. | This requires a database query to check for existence and is a critical business rule for data integrity. |
| 1.1-INT-006 | Integration | P0 | The API returns a 409 Conflict error when a registration request is sent with an email that is already in the database. | Validates the user-facing error path for a critical constraint. |

## 3. Recommended Execution Order

1.  **P0 Integration Tests (1.1-INT-005, 1.1-INT-006, 1.1-INT-001)**: Fail fast on the most critical backend business logic.
2.  **P1 Unit Tests (1.1-UNIT-001 to 005)**: Ensure all validation and internal logic is sound.
3.  **P1 Integration Tests (1.1-INT-002, 1.1-INT-003, 1.1-INT-004)**: Verify remaining API error handling.
4.  **P1 E2E Test (1.1-E2E-001)**: Perform final validation of the complete user flow.
