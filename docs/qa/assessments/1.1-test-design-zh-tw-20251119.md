# 測試設計：故事 1.1 - 新用戶註冊體驗

日期：2025-11-19
設計者：Quinn (測試架構師)

## 1. 測試策略總覽

本文件概述了「新用戶註冊」功能的測試策略。此策略基於測試金字塔模型，優先透過單元測試獲得快速回饋，透過整合測試確保元件的正確性，並透過一個端對端（E2E）測試來驗證關鍵使用者路徑。

- **總測試情境數**：12
- **單元測試**：5 (42%)
- **整合測試**：6 (50%)
- **端對端 (E2E) 測試**：1 (8%)

- **優先級分佈**：P0: 3, P1: 9, P2: 0, P3: 0

### 關於壓力測試的說明
您先前請求對此故事進行壓力測試。壓力測試屬於非功能性需求（NFR），用於評估系統在重度負載下的穩定性。

雖然本文件專注於功能性測試（單元、整合、E2E），但我強烈建議為壓力測試進行一次專門的分析。您可以透過執行以下指令來啟動此分析：`*nfr-assess 1.1`。

這將使我們能夠妥善設計測試情境，以測試高併發下的 API 回應時間、資料庫連接限制以及潛在的記憶體洩漏問題，這些都超出了標準功能測試設計的範疇。

## 2. 按驗收標準劃分的測試情境

### AC1: 用戶可以使用有效的 Email 地址和強密碼進行註冊

| ID | 層級 | 優先級 | 測試情境 | 理由 |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-INT-001 | 整合 | P0 | 使用有效的資料，透過 `POST /api/auth/register` 端點成功註冊一個新用戶。 | 這是最主要的核心 happy path，也是 P0 等級的核心使用者旅程。它驗證了從 API 端點到資料庫的整個後端流程。 |
| 1.1-UNIT-001 | 單元 | P1 | `user_service.create` 函式能使用安全性模組正確地對密碼進行雜湊處理。 | 確保密碼雜湊的核心安全邏輯在隔離環境下能如預期般運作。 |

### AC2: 系統會驗證 Email 格式和密碼強度要求

| ID | 層級 | 優先級 | 測試情境 | 理由 |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-UNIT-002 | 單元 | P1 | `UserCreate` 的 schema 驗證器會拒絕無效的 Email 格式（例如：缺少 '@'、沒有網域名稱）。 | 純粹的驗證邏輯，可在模型層級進行測試以獲得快速回饋。 |
| 1.1-UNIT-003 | 單元 | P1 | `UserCreate` 的 schema 驗證器會拒絕強度不足的密碼（例如：太短、沒有大寫字母、沒有數字）。 | 針對關鍵安全性需求的純粹驗證邏輯。 |
| 1.1-UNIT-004 | 單元 | P1 | `UserCreate` 的 schema 驗證器能接受多種有效的 Email 格式。 | 確保驗證邏輯不會過於嚴格而導致誤判。 |
| 1.1-UNIT-005 | 單元 | P1 | `UserCreate` 的 schema 驗證器能接受剛好滿足最低要求的密碼。 | 針對驗證邏輯的邊界條件測試。 |
| 1.1-INT-002 | 整合 | P1 | 當註冊請求包含無效的 Email 格式時，API 會回傳 422 Unprocessable Entity 錯誤。 | 驗證 schema 的驗證錯誤能被正確地傳播到 API 的回應中。 |
| 1.1-INT-003 | 整合 | P1 | 當請求包含強度不足的密碼時，API 會回傳 422 Unprocessable Entity 錯誤。 | 驗證 API 層級對於安全性需求的錯誤處理。 |

### AC3: 用戶需要提供顯示名稱作為平台識別

| ID | 層級 | 優先級 | 測試情境 | 理由 |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-INT-004 | 整合 | P1 | 如果請求中缺少 `display_name` 欄位，API 會回傳 422 Unprocessable Entity 錯誤。 | 驗證 API 層級會強制執行必填欄位。 |

### AC4: 註冊成功後自動登入並導向歡迎頁面

| ID | 層級 | 優先級 | 測試情境 | 理由 |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-E2E-001 | E2E | P1 | 一位用戶在 UI 上填寫註冊表單，提交後被重新導向到歡迎頁面，並顯示其用戶名稱。 | 這是一個關鍵的使用者旅程，只能在瀏覽器環境中進行完整驗證，以確保前端和後端已正確整合。 |

### AC5: 重複 Email 註冊會顯示友善的錯誤提示

| ID | 層級 | 優先級 | 測試情境 | 理由 |
| :--- | :--- | :--- | :--- | :--- |
| 1.1-INT-005 | 整合 | P0 | 當試圖使用已存在的 Email 建立用戶時，`user_service.create` 函式會引發一個特定的例外。 | 這需要進行資料庫查詢以檢查資料是否存在，是確保資料完整性的關鍵業務規則。 |
| 1.1-INT-006 | 整合 | P0 | 當註冊請求使用的 Email 已存在於資料庫中時，API 會回傳 409 Conflict 錯誤。 | 驗證針對關鍵限制條件的使用者端錯誤路徑。 |

## 3. 建議執行順序

1.  **P0 整合測試 (1.1-INT-005, 1.1-INT-006, 1.1-INT-001)**：最優先執行，以便快速發現最關鍵後端業務邏輯中的問題。
2.  **P1 單元測試 (1.1-UNIT-001 至 005)**：確保所有的驗證和內部邏輯都健全。
3.  **P1 整合測試 (1.1-INT-002, 1.1-INT-003, 1.1-INT-004)**：驗證剩餘的 API 錯誤處理。
4.  **P1 E2E 測試 (1.1-E2E-001)**：對完整的使用者流程進行最終驗證。
