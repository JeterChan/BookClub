# Test Design: Story 4.1.notification-system

Date: 2025-11-28
Designer: Quinn (Test Architect)

## Test Strategy Overview

- **Objective**: Validate the Notification System for Epic 4.1, ensuring reliability of notification generation, delivery, and management.
- **Scope**: Backend services, API endpoints, and Frontend components for notifications.
- **Total test scenarios**: 11
- **Unit tests**: 8 (73%)
- **Integration tests**: 3 (27%)
- **E2E tests**: 0 (0%) - Defer until full flow integration.
- **Priority distribution**: P0: 2, P1: 7, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: Owner/Admin notified on join request

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification            |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------ |
| 4.1-UNIT-001 | Unit        | P1       | Service: `notify_new_join_request` logic | Verify recipient logic (owner+admins). |
| 4.1-INT-001  | Integration | P1       | Flow: `join_book_club` triggers notification | Verify cross-service integration. |

### AC2: Members notified on event creation (excluding creator)

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification            |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------ |
| 4.1-UNIT-002 | Unit        | P1       | Service: `notify_event_created` logic    | Verify exclusion of organizer. |
| 4.1-INT-002  | Integration | P1       | Flow: `create_event` triggers notification | Verify cross-service integration. |

### AC3: User can view list (read/unread)

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification            |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------ |
| 4.1-UNIT-003 | Unit        | P1       | API: `GET /notifications` filtering      | Verify `is_read` filter logic. |
| 4.1-UNIT-004 | Unit        | P1       | API: `GET /notifications` sorting        | Verify sort by `created_at` desc. |

### AC4: User can mark as read

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification            |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------ |
| 4.1-UNIT-005 | Unit        | P1       | API: `POST /notifications/{id}/read`     | Verify status update. |
| 4.1-UNIT-006 | Unit        | P0       | Security: Cannot read others' notifications | **Critical Security Check**. |

### AC5: Context Content

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification            |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------ |
| 4.1-UNIT-007 | Unit        | P2       | Model: JSON Content Serialization        | Ensure content dict is stored correctly. |

### AC6: Frontend Display

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification            |
| ------------ | ----------- | -------- | ----------------------------------------- | ------------------------ |
| 4.1-FE-UNIT-001 | Unit     | P2       | Component: `NotificationItem` rendering  | Verify correct icon/text per type. |
| 4.1-FE-INT-001 | Integration | P1    | Store: `fetchNotifications` updates state | Verify store logic. |

## Risk Coverage

- **Risk**: Security bypass (User A marks User B's notification).
  - Mitigation: `4.1-UNIT-006` (P0)
- **Risk**: Notification spam (Duplicate notifications).
  - Mitigation: `4.1-UNIT-001` logic check.

## Recommended Execution Order

1. P0 Unit tests (Security check).
2. P1 Unit/Integration tests.
3. P2 UI tests.
