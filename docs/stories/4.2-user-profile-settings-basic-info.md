# Story 4.2: 使用者個人檔案設定 - 查看與編輯個人基本資料

**Status:** Ready
**Epic:** Epic 4 - 智能互動與個人化體驗
**Story Points:** 5
**Priority:** 高

---

## Story

**身為** 一個平台會員，
**我想要** 在一個專門的設定頁面查看並編輯我的基本個人資料（如顯示名稱和個人簡介），
**如此一來** 我便可以隨時更新我的個人資訊。

---

## Acceptance Criteria

1.  **AC1 - 導航至設定頁:** 使用者可以從 `Header` 的使用者選單中，點擊連結導航至「個人檔案設定」頁面 (`/profile/settings`)。
2.  **AC2 - 顯示現有資料:** 進入頁面時，系統會自動從後端 (`GET /api/users/me/profile`) 獲取並在表單中顯示使用者目前的「顯示名稱 (`display_name`)」和「個人簡介 (`bio`)」。
3.  **AC3 - 編輯與儲存:** 使用者可以自由編輯這兩個欄位的內容。只有當表單內容被修改後，「儲存變更」按鈕才變為可點擊狀態。
4.  **AC4 - 更新資料:** 點擊「儲存變更」後，前端會呼叫後端 API (`PUT /api/users/me/profile`) 來更新資料。
5.  **AC5 - 成功反饋:** 成功儲存後，系統會顯示一個成功的提示訊息 (Toast)，並且 `Header` 上顯示的使用者名稱會同步更新，無需重新整理頁面。
6.  **AC6 - 失敗反饋:** 如果儲存失敗，系統會顯示一個錯誤的提示訊息。

---

## Tasks / Subtasks

### Task 1: Backend (No new work needed)
- [x] 後端 `GET /api/users/me/profile` 和 `PUT /api/users/me/profile` 端點已經存在且功能符合需求。無需進行新的後端開發。

### Task 2: Frontend
- [ ] 2.1 **(AC1)** 在 `frontend/src/components/common/Header.tsx` 的使用者下拉選單中，新增一個指向 `/profile/settings` 的連結。
- [ ] 2.2 **(AC1)** 在 `frontend/src/App.tsx` 或路由設定檔案中，新增 `/profile/settings` 路由，並將其指向新建的 `ProfileSettingsPage` 組件。
- [ ] 2.3 **(AC2)** 建立新的頁面組件 `frontend/src/pages/profile/ProfileSettingsPage.tsx`。
- [ ] 2.4 **(AC2)** 在 `ProfileSettingsPage` 組件中，使用 `useEffect` hook，在組件掛載時呼叫 `profileService.getProfile()` 來獲取使用者資料並填充表單。
- [ ] 2.5 **(AC3)** 實作表單狀態管理，監聽表單欄位的變更，並在內容變更時啟用「儲存變更」按鈕。
- [ ] 2.6 **(AC4)** 建立表單的 `onSubmit` 處理函式。該函式呼叫 `profileService.updateProfile()`，並在請求期間將按鈕設為載入中狀態。
- [ ] 2.7 **(AC5)** 在 `profileService.updateProfile()` 成功後，呼叫 `authStore.setUser()` action 來更新全域狀態中的 `user` 物件，以確保 `Header` 等處的資訊同步更新。
- [ ] 2.8 **(AC5, AC6)** 使用 `react-hot-toast` 在操作成功或失敗時顯示對應的提示訊息。

---

## Dev Notes

### API Specifications
- **Get Profile Endpoint**: `GET /api/users/me/profile`
  - **功能**: 獲取當前登入使用者的詳細個人資料。
  - **成功回應**: `200 OK`，包含 `UserProfile` 物件。
- **Update Profile Endpoint**: `PUT /api/users/me/profile`
  - **功能**: 更新當前登入使用者的部分個人資料（如 `display_name`, `bio`）。
  - **請求內文**: `UpdateProfileData` 物件 (`{ "display_name": "...", "bio": "..." }`)。
  - **成功回應**: `200 OK`，包含更新後的 `UserProfile` 物件。

### Component Specifications
- **`ProfileSettingsPage.tsx`**:
  - 應包含頁面標題、一個 `form` 元素、用於 `display_name` 的 `Input` 組件、用於 `bio` 的 `Textarea` 組件，以及一個 `Button` 組件用於提交。
  - 應參考 `frontend/src/pages/clubs/ClubSettings.tsx` 的整體頁面佈局和樣式。
  - 表單提交按鈕需處理 `disabled` 和 `loading` 狀態。

### File Locations
- **Frontend Page**: `frontend/src/pages/profile－/ProfileSettingsPage.tsx` (需新建)
- **Frontend Routing**: `frontend/src/App.tsx` (或專案的路由設定檔案)
- **Header Component**: `frontend/src/components/common/Header.tsx` (需修改)
- **Profile Service**: `frontend/src/services/profileService.ts` (使用現有函式)
- **Auth Store**: `frontend/src/store/authStore.ts` (使用現有 action)

### Testing Requirements
- **Frontend**:
  - **互動測試**: 需測試在 `ProfileSettingsPage` 中：
    1.  資料是否正確載入表單。
    2.  修改表單後，儲存按鈕是否啟用。
    3.  點擊儲存後，是否成功呼叫 `updateProfile` 服務。
    4.  成功或失敗時，是否顯示正確的 `toast` 訊息。

---

## Dev Agent Record

### File List
- `frontend/src/pages/profile/ProfileSettingsPage.tsx`
- `frontend/src/App.tsx`
- `frontend/src/components/common/Header.tsx`