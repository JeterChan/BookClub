---
epic: 4
story_id: 3
title: "使用者個人檔案設定 - 上傳與管理個人頭像"
status: "Draft"
---

### User Story

**身為** 一個平台會員，
**我想要** 在我的個人檔案設定頁面中，上傳、更換或移除我的大頭貼，
**如此一來** 我便可以進一步客製化我的帳號外觀，提升個人識別度。

### Story Context

- **Epic:** 智能互動與個人化體驗
- **Dependencies:** 這個故事基於 `4.2-user-profile-settings-basic-info.md` 所建立的「個人檔案設定」頁面。
- **Existing System Integration:**
  - **Integrates with:** `profileService`, `useAuthStore`
  - **Technology:** React, TypeScript, FastAPI (for file uploads)
  - **Follows pattern:** 檔案上傳的 UI 應與現有表單風格保持一致。移除操作的確認視窗應使用現有的 `ConfirmationModal` 組件。
  - **Touch points:**
    - 修改在故事 4.2 中建立的 `/profile/settings` 頁面組件。
    - 使用現有的 `profileService.uploadAvatar` 服務 (POST /api/users/me/avatar)。
    - 使用現有的 `profileService.removeAvatar` 服務 (DELETE /api/users/me/avatar)。
    - 成功操作後，需同步更新 `useAuthStore` 中的 `user.avatar_url` 狀態。

### Acceptance Criteria

1.  在「個人檔案設定」頁面，使用者可以看到一個用於管理大頭貼的區塊。
2.  此區塊會顯示使用者目前的大頭貼。如果使用者沒有設定大頭貼，則顯示一個預設的圖示或圖片。
3.  提供一個「上傳新照片」按鈕，點擊後會開啟系統的檔案選擇視窗，並篩選圖片檔案（如 .jpg, .png）。
4.  使用者選擇圖片後，系統應顯示預覽（可選），並開始上傳。在上傳過程中，相關按鈕應顯示為載入中狀態。
5.  成功上傳後，頁面上的大頭貼和 `Header` 中的大頭貼應立即更新，無需重新整理頁面，並顯示成功的提示訊息。
6.  如果上傳失敗（例如，檔案過大、格式不符），則顯示錯誤的提示訊息。
7.  如果使用者已設定大頭貼，頁面會顯示一個「移除照片」按鈕。
8.  點擊「移除照片」按鈕時，會彈出一個確認視窗，詢問使用者是否確定要移除。
9.  在確認移除後，系統會呼叫移除大頭貼的服務，並在成功後將顯示的圖片還原為預設圖示，同時顯示成功的提示訊息。

### Technical Notes

- **Integration Approach:**
  - 修改個人檔案設定頁面的組件，新增處理檔案上傳的邏輯。
  - 使用 `FormData` 物件來建構 `multipart/form-data` 請求以進行檔案上傳。
- **Existing Pattern Reference:**
  - 移除大頭貼的確認視窗應重用 `ConfirmationModal` 組件。
- **Key Constraints:**
  - 建議在前端對檔案大小和類型進行初步驗證，以改善使用者體驗。
  - 後端 API 應有完整的檔案驗證機制。

### Definition of Done

- [ ] 功能性需求已全部滿足。
- [ ] 整合需求已通過驗證。
- [ ] 對現有功能進行了回歸測試，無不良影響。
- [ ] 程式碼遵循現有的模式和標準。
- [ ] 相關測試已通過。
- [ ] 如有需要，相關文件已更新。
