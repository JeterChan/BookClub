# Story 2.7: å„€è¡¨æ¿æœ€è¿‘æ´»å‹• - é¡¯ç¤ºè®€æ›¸æœƒæ´»å‹•

## ğŸ“‹ ä½¿ç”¨è€…æ•…äº‹

**èº«ä»½ (As a)**: å·²ç™»å…¥çš„è®€æ›¸æœƒæˆå“¡

**æˆ‘æƒ³è¦ (I want to)**: åœ¨å€‹äººå„€è¡¨æ¿çš„ã€Œæœ€è¿‘æ´»å‹•ã€å€å¡Šä¸­ï¼Œçœ‹åˆ°æˆ‘æ‰€åƒèˆ‡è®€æ›¸æœƒçš„æœ€æ–°æ´»å‹•

**ç›®çš„ (So that)**: æˆ‘å¯ä»¥å¿«é€ŸæŒæ¡æˆ‘æ‰€åƒèˆ‡è®€æ›¸æœƒçš„æœ€æ–°æ´»å‹•å‹•æ…‹ï¼Œä¸æœƒéŒ¯éé‡è¦çš„è®€æ›¸æœƒæ´»å‹•

---

## ğŸ“ è©³ç´°éœ€æ±‚

### **åŠŸèƒ½æè¿°**

1. **è³‡æ–™ä¾†æº**
   - å¾ä½¿ç”¨è€…åƒèˆ‡çš„æ‰€æœ‰è®€æ›¸æœƒä¸­ç²å–æ´»å‹•è³‡æ–™
   - æ´»å‹•é¡å‹ï¼šè®€æ›¸æœƒèˆ‰è¾¦çš„å¯¦é«”/ç·šä¸Šæ´»å‹• (Event)
   - æ™‚é–“ç¯„åœï¼šæœªä¾†çš„æ´»å‹•å„ªå…ˆï¼Œä¹ŸåŒ…å«è¿‘æœŸçµæŸçš„æ´»å‹•

2. **é¡¯ç¤ºè¦å‰‡**
   - æŒ‰ç…§æ´»å‹•æ™‚é–“æ’åºï¼ˆ`event_datetime`ï¼‰
   - å³å°‡èˆ‰è¡Œçš„æ´»å‹•å„ªå…ˆé¡¯ç¤º
   - é è¨­é¡¯ç¤ºæœ€æ–°çš„ 3 å€‹æ´»å‹•
   - æ¯å€‹æ´»å‹•é¡¯ç¤ºï¼š
     * æ´»å‹•åç¨±
     * æ‰€å±¬è®€æ›¸æœƒåç¨±ï¼ˆå¯é»æ“Šï¼‰
     * æ´»å‹•æ™‚é–“ï¼ˆç›¸å°æ™‚é–“ + å®Œæ•´æ™‚é–“ï¼‰
     * æ´»å‹•ç‹€æ…‹ï¼ˆå³å°‡èˆ‰è¡Œ/é€²è¡Œä¸­/å·²çµæŸï¼‰
     * åƒèˆ‡ç‹€æ…‹ï¼ˆå·²å ±å/æœªå ±åï¼‰

3. **äº’å‹•åŠŸèƒ½**
   - é»æ“Šæ´»å‹• â†’ è·³è½‰åˆ°æ´»å‹•è©³ç´°é é¢
   - é»æ“Šè®€æ›¸æœƒåç¨± â†’ è·³è½‰åˆ°è®€æ›¸æœƒé é¢
   - é»æ“Šã€ŒæŸ¥çœ‹å…¨éƒ¨ã€â†’ è·³è½‰åˆ°ã€Œæˆ‘çš„æ´»å‹•ã€é é¢

4. **ç©ºç‹€æ…‹**
   - ç•¶æ²’æœ‰æ´»å‹•æ™‚ï¼Œé¡¯ç¤ºï¼šã€Œç›®å‰æ²’æœ‰å³å°‡èˆ‰è¡Œçš„æ´»å‹•ã€
   - æä¾›ã€Œæ¢ç´¢è®€æ›¸æœƒã€æŒ‰éˆ•

---

## ğŸ¯ é©—æ”¶æ¨™æº– (Acceptance Criteria)

### **å‰ç«¯é¡¯ç¤º**
- [ ] å„€è¡¨æ¿é¡¯ç¤ºã€Œæœ€è¿‘æ´»å‹•ã€å€å¡Šæ¨™é¡Œ
- [ ] é è¨­é¡¯ç¤ºæœ€å¤š 3 å€‹æ´»å‹•
- [ ] æ´»å‹•æŒ‰æ™‚é–“æ’åºï¼ˆæœ€è¿‘çš„å„ªå…ˆï¼‰
- [ ] æ¯å€‹æ´»å‹•é¡¯ç¤ºå®Œæ•´è³‡è¨Šï¼ˆåç¨±ã€è®€æ›¸æœƒã€æ™‚é–“ã€ç‹€æ…‹ï¼‰
- [ ] é¡¯ç¤ºç›¸å°æ™‚é–“ï¼ˆå¦‚ã€Œ3å¤©å¾Œã€ã€ã€Œæ˜å¤© 14:00ã€ï¼‰
- [ ] å·²å ±åçš„æ´»å‹•æœ‰è¦–è¦ºæ¨™ç¤ºï¼ˆå¦‚ç¶ è‰²å‹¾å‹¾åœ–ç¤ºï¼‰
- [ ] æœ‰ã€ŒæŸ¥çœ‹å…¨éƒ¨ã€é€£çµï¼ˆç•¶æœ‰è¶…é3å€‹æ´»å‹•æ™‚ï¼‰

### **äº’å‹•åŠŸèƒ½**
- [ ] é»æ“Šæ´»å‹•å¡ç‰‡å¯è·³è½‰åˆ°æ´»å‹•è©³ç´°é é¢
- [ ] é»æ“Šè®€æ›¸æœƒåç¨±å¯è·³è½‰åˆ°è®€æ›¸æœƒé é¢
- [ ] é»æ“Šã€ŒæŸ¥çœ‹å…¨éƒ¨ã€è·³è½‰åˆ° `/activities/my-events` é é¢

### **æˆ‘çš„æ´»å‹•é é¢ (`/activities/my-events`)**
- [ ] é¡¯ç¤ºæ‰€æœ‰åƒèˆ‡è®€æ›¸æœƒçš„æ´»å‹•åˆ—è¡¨
- [ ] æ”¯æ´åˆ†é ï¼ˆæ¯é  20 å€‹æ´»å‹•ï¼‰
- [ ] æ”¯æ´ç¯©é¸ï¼šå…¨éƒ¨/å³å°‡èˆ‰è¡Œ/å·²çµæŸ
- [ ] æ”¯æ´ç¯©é¸ï¼šå…¨éƒ¨/å·²å ±å/æœªå ±å
- [ ] æ”¯æ´æŒ‰è®€æ›¸æœƒç¯©é¸

### **å¾Œç«¯ API**
- [ ] æ–°å¢ API: `GET /api/v1/users/me/events`
- [ ] æŸ¥è©¢åƒæ•¸ï¼š
  - `page` (int): é ç¢¼
  - `page_size` (int): æ¯é æ•¸é‡
  - `status` (string): published/completed/cancelled
  - `participation` (string): all/registered/not_registered
  - `club_id` (int, optional): ä¾è®€æ›¸æœƒç¯©é¸
- [ ] å›æ‡‰åŒ…å«ï¼š
  - æ´»å‹•åˆ—è¡¨ï¼ˆå«è®€æ›¸æœƒè³‡è¨Šï¼‰
  - åˆ†é è³‡è¨Š
  - ä½¿ç”¨è€…åƒèˆ‡ç‹€æ…‹

### **è³‡æ–™åº«æŸ¥è©¢**
- [ ] æŸ¥è©¢ä½¿ç”¨è€…åŠ å…¥çš„æ‰€æœ‰è®€æ›¸æœƒ
- [ ] æŸ¥è©¢é€™äº›è®€æ›¸æœƒçš„æ´»å‹•ï¼ˆstatus = 'published'ï¼‰
- [ ] Join EventParticipant è¡¨ä»¥ç²å–åƒèˆ‡ç‹€æ…‹
- [ ] æŒ‰ event_datetime ASC æ’åº

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œå»ºè­°

### **å¾Œç«¯å¯¦ä½œ**

**1. å»ºç«‹ API Endpoint**
```python
# backend/app/api/endpoints/user_events.py

@router.get("/me/events", response_model=PaginatedEventList)
def get_my_events(
    *,
    session: Session = Depends(get_session),
    current_user: User = Depends(get_current_user),
    page: int = Query(1, ge=1),
    page_size: int = Query(20, ge=1, le=100),
    status: Optional[EventStatus] = Query(None),
    participation: Optional[str] = Query(None),
    club_id: Optional[int] = Query(None)
):
    """ç²å–ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•"""
    pass
```

**2. Service Layer**
```python
# backend/app/services/user_event_service.py

def get_user_club_events(
    session: Session,
    user_id: int,
    page: int = 1,
    page_size: int = 20,
    status: Optional[EventStatus] = None,
    participation: Optional[str] = None,
    club_id: Optional[int] = None
):
    """
    æŸ¥è©¢ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ´»å‹•
    1. æŸ¥è©¢ä½¿ç”¨è€…çš„è®€æ›¸æœƒ
    2. æŸ¥è©¢é€™äº›è®€æ›¸æœƒçš„æ´»å‹•
    3. æ¨™ç¤ºä½¿ç”¨è€…åƒèˆ‡ç‹€æ…‹
    """
    pass
```

**3. Schema**
```python
# backend/app/schemas/user_event.py

class UserEventRead(BaseModel):
    id: int
    title: str
    event_datetime: datetime
    club_id: int
    club_name: str
    club_cover_image_url: Optional[str]
    status: EventStatus
    is_registered: bool
    current_participants: int
    max_participants: Optional[int]
```

### **å‰ç«¯å¯¦ä½œ**

**1. æ›´æ–° Dashboard Service**
```typescript
// frontend/src/services/dashboardService.ts

export interface ClubEvent {
  id: number;
  title: string;
  eventDatetime: string;
  clubId: number;
  clubName: string;
  clubCoverImageUrl: string | null;
  status: 'published' | 'completed' | 'cancelled';
  isRegistered: boolean;
  currentParticipants: number;
  maxParticipants: number | null;
}

export const getUserClubEvents = async (limit: number = 3): Promise<ClubEvent[]> => {
  const response = await apiClient.get<{ items: ClubEvent[] }>(
    `/api/v1/users/me/events?page=1&page_size=${limit}`
  );
  return response.data.items;
};
```

**2. å»ºç«‹æ´»å‹•åˆ—è¡¨å…ƒä»¶**
```typescript
// frontend/src/components/dashboard/RecentEvents.tsx

export const RecentEvents = () => {
  const [events, setEvents] = useState<ClubEvent[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadEvents();
  }, []);

  // æ¸²æŸ“æ´»å‹•å¡ç‰‡
  // ...
};
```

**3. å»ºç«‹æˆ‘çš„æ´»å‹•é é¢**
```typescript
// frontend/src/pages/activities/MyEvents.tsx

export default function MyEvents() {
  // å®Œæ•´çš„æ´»å‹•åˆ—è¡¨é é¢
  // æ”¯æ´ç¯©é¸ã€åˆ†é 
}
```

**4. æ›´æ–° Dashboard**
```typescript
// frontend/src/pages/Dashboard.tsx

// å°‡ ActivityTimeline æ”¹ç‚º RecentEvents
<RecentEvents />
```

---

## ğŸ“Š è³‡æ–™æµç¨‹

```
ä½¿ç”¨è€… â†’ Dashboard 
  â†“
RecentEvents å…ƒä»¶
  â†“
getUserClubEvents(3)
  â†“
GET /api/v1/users/me/events?page_size=3
  â†“
å¾Œç«¯æŸ¥è©¢ï¼š
  1. æŸ¥è©¢ä½¿ç”¨è€…çš„è®€æ›¸æœƒ (BookClubMember)
  2. æŸ¥è©¢é€™äº›è®€æ›¸æœƒçš„æ´»å‹• (Event)
  3. Join EventParticipant ç²å–åƒèˆ‡ç‹€æ…‹
  4. æ’åºä¸¦å›å‚³å‰ 3 ç­†
  â†“
å›å‚³æ´»å‹•åˆ—è¡¨ + è®€æ›¸æœƒè³‡è¨Š + åƒèˆ‡ç‹€æ…‹
  â†“
å‰ç«¯é¡¯ç¤ºæ´»å‹•å¡ç‰‡
```

---

## ğŸ¨ UI/UX è¨­è¨ˆå»ºè­°

**æ´»å‹•å¡ç‰‡è¨­è¨ˆ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ï¿½ï¿½ é€±æœ«è®€æ›¸åˆ†äº«æœƒ                    â”‚
â”‚ ğŸ“š ç§‘å¹»å°èªªæ„›å¥½è€…                    â”‚
â”‚ ğŸ•’ æ˜å¤© 14:00 (2024-11-05)         â”‚
â”‚ âœ… å·²å ±å Â· 15/20 äºº                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‹€æ…‹æ¨™ç¤º**ï¼š
- å³å°‡èˆ‰è¡Œï¼šè—è‰²é‚Šæ¡†
- å·²å ±åï¼šç¶ è‰²å‹¾å‹¾
- å·²é¡æ»¿ï¼šç´…è‰²æ¨™ç±¤
- å·²çµæŸï¼šç°è‰²æ–‡å­—

---

## âš ï¸ æ³¨æ„äº‹é …

1. **æ•ˆèƒ½è€ƒé‡**
   - ä½¿ç”¨è³‡æ–™åº«ç´¢å¼• (event_datetime, club_id, status)
   - å‰ç«¯å¿«å–æ©Ÿåˆ¶ï¼ˆ5åˆ†é˜ï¼‰
   - é¿å… N+1 æŸ¥è©¢å•é¡Œ

2. **é‚Šç•Œæƒ…æ³**
   - ä½¿ç”¨è€…æœªåŠ å…¥ä»»ä½•è®€æ›¸æœƒ
   - è®€æ›¸æœƒæ²’æœ‰ä»»ä½•æ´»å‹•
   - æ‰€æœ‰æ´»å‹•éƒ½å·²çµæŸ

3. **æœªä¾†æ“´å……**
   - æ¨æ’­é€šçŸ¥ï¼ˆæ´»å‹•å³å°‡é–‹å§‹ï¼‰
   - è¡Œäº‹æ›†æ•´åˆ
   - æ´»å‹•æé†’åŠŸèƒ½

---

## ğŸ“‹ å»ºè­°çš„å¯¦ä½œé †åº

1. **Phase 1**: å¾Œç«¯ API å¯¦ä½œ
   - å»ºç«‹è³‡æ–™åº«æŸ¥è©¢é‚è¼¯
   - å¯¦ä½œ API endpoint
   - å–®å…ƒæ¸¬è©¦

2. **Phase 2**: Dashboard å€å¡Šå¯¦ä½œ
   - å»ºç«‹ RecentEvents å…ƒä»¶
   - æ•´åˆåˆ° Dashboard
   - é¡¯ç¤ºå‰ 3 å€‹æ´»å‹•

3. **Phase 3**: æˆ‘çš„æ´»å‹•é é¢
   - å»ºç«‹ MyEvents é é¢
   - å¯¦ä½œç¯©é¸åŠŸèƒ½
   - å¯¦ä½œåˆ†é åŠŸèƒ½

4. **Phase 4**: æ¸¬è©¦èˆ‡å„ªåŒ–
   - æ•´åˆæ¸¬è©¦
   - æ•ˆèƒ½å„ªåŒ–
   - UI/UX èª¿æ•´

---

## âœ… Definition of Done

- [ ] æ‰€æœ‰é©—æ”¶æ¨™æº–é€šé
- [ ] å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
- [ ] æ•´åˆæ¸¬è©¦é€šé
- [ ] ç¨‹å¼ç¢¼å¯©æŸ¥é€šé
- [ ] æ–‡ä»¶æ›´æ–°å®Œæˆ
- [ ] ç”¢å“è² è²¬äººé©—æ”¶é€šé

---

## ğŸ“… é ä¼°æ™‚é–“

- å¾Œç«¯é–‹ç™¼ï¼š3-4 å°æ™‚
- å‰ç«¯é–‹ç™¼ï¼š4-5 å°æ™‚
- æ¸¬è©¦ï¼š2-3 å°æ™‚
- **ç¸½è¨ˆï¼š9-12 å°æ™‚**

---

## ğŸ”— ç›¸é—œ Stories

- Story 2.1: æ´»å‹•ç®¡ç†ç³»çµ±åŸºç¤å»ºè¨­
- Story 2.2: å»ºç«‹è®€æ›¸æœƒæ´»å‹•
- Story 2.3: æ´»å‹•å ±ååŠŸèƒ½

---

**å»ºç«‹æ—¥æœŸ**: 2024-11-04  
**æœ€å¾Œæ›´æ–°**: 2024-11-04  
**Story ID**: 2.7  
**å„ªå…ˆç´š**: High  
**ç‹€æ…‹**: Ready for Development
