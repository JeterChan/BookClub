# Story 2.7: å„€è¡¨æ¿æœ€è¿‘æ´»å‹• - é–‹ç™¼å¯¦ä½œ

**Status**: Ready for Review

**Story ID**: 2.7  
**å„ªå…ˆç´š**: High  
**é ä¼°æ™‚é–“**: 9-12 å°æ™‚  
**é–‹ç™¼è€…**: agent dev

---

## Story

**As a** å·²ç™»å…¥çš„è®€æ›¸æœƒæˆå“¡  
**I want** åœ¨å€‹äººå„€è¡¨æ¿çœ‹åˆ°æˆ‘æ‰€åƒèˆ‡è®€æ›¸æœƒçš„æœ€æ–°æ´»å‹•  
**so that** æˆ‘å¯ä»¥å¿«é€ŸæŒæ¡æ´»å‹•å‹•æ…‹ï¼Œä¸æœƒéŒ¯éé‡è¦çš„è®€æ›¸æœƒæ´»å‹•

---

## Acceptance Criteria

1. [x] å„€è¡¨æ¿é¡¯ç¤ºã€Œæœ€è¿‘æ´»å‹•ã€å€å¡Šï¼Œé è¨­é¡¯ç¤ºæœ€å¤š 3 å€‹æ´»å‹•
2. [x] æ´»å‹•æŒ‰æ™‚é–“æ’åºï¼ˆå³å°‡èˆ‰è¡Œçš„æ´»å‹•å„ªå…ˆï¼‰
3. [x] æ¯å€‹æ´»å‹•é¡¯ç¤ºå®Œæ•´è³‡è¨Šï¼ˆåç¨±ã€è®€æ›¸æœƒã€æ™‚é–“ã€ç‹€æ…‹ã€åƒèˆ‡äººæ•¸ï¼‰
4. [x] å·²å ±åçš„æ´»å‹•æœ‰è¦–è¦ºæ¨™ç¤ºï¼ˆç¶ è‰²å‹¾å‹¾åœ–ç¤ºï¼‰
5. [x] é»æ“Šæ´»å‹•å¡ç‰‡è·³è½‰åˆ°æ´»å‹•è©³ç´°é é¢
6. [x] é»æ“Šè®€æ›¸æœƒåç¨±è·³è½‰åˆ°è®€æ›¸æœƒé é¢
7. [x] é»æ“Šã€ŒæŸ¥çœ‹å…¨éƒ¨ã€è·³è½‰åˆ°ã€Œæˆ‘çš„æ´»å‹•ã€å®Œæ•´åˆ—è¡¨é é¢
8. [x] ã€Œæˆ‘çš„æ´»å‹•ã€é é¢æ”¯æ´åˆ†é ã€ç‹€æ…‹ç¯©é¸ã€åƒèˆ‡ç‹€æ…‹ç¯©é¸

---

## Dev Notes

### æŠ€è¡“æ£§ (Tech Stack)
- **å¾Œç«¯**: Python 3.11+, FastAPI, SQLModel
- **å‰ç«¯**: React 18, TypeScript, Vite, React Router v6
- **ç‹€æ…‹ç®¡ç†**: Zustand
- **æ—¥æœŸè™•ç†**: date-fns
- **è³‡æ–™åº«**: PostgreSQL

### è³‡æ–™æ¨¡å‹ (Data Models)
æœ¬åŠŸèƒ½éœ€è¦æŸ¥è©¢ä»¥ä¸‹ç¾æœ‰æ¨¡å‹ï¼š
- `Event` - æ´»å‹•è³‡æ–™
- `EventParticipant` - æ´»å‹•åƒèˆ‡è€…
- `BookClub` - è®€æ›¸æœƒè³‡æ–™
- `BookClubMember` - è®€æ›¸æœƒæˆå“¡

---


## Tasks / Subtasks

### Task 1: å¾Œç«¯ API å¯¦ä½œ (AC: 1, 2, 3, 4, 8)

#### 1.1 å»ºç«‹ Schema
- [x] å»ºç«‹ `backend/app/schemas/user_event.py`
  - [x] `UserEventRead` schema
    - æ¬„ä½ï¼š`id`, `title`, `description`, `event_datetime`, `meeting_url`
    - æ¬„ä½ï¼š`club_id`, `club_name`, `club_cover_image_url`
    - æ¬„ä½ï¼š`status`, `is_registered`, `is_organizer`
    - æ¬„ä½ï¼š`current_participants`, `max_participants`, `created_at`
  - [x] `PaginatedUserEventList` schema
    - æ¬„ä½ï¼š`items` (List[UserEventRead]), `pagination` (PaginationMeta)

#### 1.2 å»ºç«‹ Service Layer
- [x] å»ºç«‹ `backend/app/services/user_event_service.py`
  - [x] å¯¦ä½œ `get_user_club_events()` å‡½æ•¸
    - åƒæ•¸ï¼š`session`, `user_id`, `page`, `page_size`, `status`, `participation`, `club_id`
    - æŸ¥è©¢ä½¿ç”¨è€…åŠ å…¥çš„è®€æ›¸æœƒ (`BookClubMember`)
    - æŸ¥è©¢é€™äº›è®€æ›¸æœƒçš„æ´»å‹• (`Event`)
    - Join `BookClub` ç²å–è®€æ›¸æœƒè³‡è¨Š
    - Join `EventParticipant` ç²å–åƒèˆ‡äººæ•¸å’Œä½¿ç”¨è€…åƒèˆ‡ç‹€æ…‹
    - æŒ‰ `event_datetime` ASC æ’åº
    - å¯¦ä½œåˆ†é é‚è¼¯
    - å¯¦ä½œç¯©é¸é‚è¼¯ï¼ˆstatus, participation, club_idï¼‰
    - è¿”å›æ´»å‹•åˆ—è¡¨å’Œåˆ†é è³‡è¨Š

#### 1.3 å»ºç«‹ API Endpoint
- [x] å»ºç«‹ `backend/app/api/endpoints/user_events.py`
  - [x] `GET /api/v1/users/me/events` ç«¯é»ï¼ˆéœ€èªè­‰ï¼‰
    - Query Parameters:
      - `page` (int, default=1): é ç¢¼
      - `page_size` (int, default=20): æ¯é æ•¸é‡
      - `status` (EventStatus, optional): æ´»å‹•ç‹€æ…‹ç¯©é¸
      - `participation` (str, optional): åƒèˆ‡ç‹€æ…‹ç¯©é¸ (all/registered/not_registered)
      - `club_id` (int, optional): è®€æ›¸æœƒ ID ç¯©é¸
    - å›æ‡‰ï¼š`PaginatedUserEventList`
    - å‘¼å« `user_event_service.get_user_club_events()`

#### 1.4 è¨»å†Šè·¯ç”±
- [x] åœ¨ `backend/app/api/api.py` å°å…¥ä¸¦è¨»å†Š `user_events`
  - prefix: `/api/v1/users`
  - tags: `["user-events"]`

#### 1.5 è³‡æ–™åº«ç´¢å¼•å„ªåŒ–
- [ ] å»ºç«‹ Alembic migration: `add_event_indexes.py`
  - [ ] æ–°å¢ç´¢å¼•ï¼š`ix_event_datetime` on `event.event_datetime`
  - [ ] æ–°å¢è¤‡åˆç´¢å¼•ï¼š`ix_event_club_id_status` on `event.club_id`, `event.status`
- [ ] åŸ·è¡Œ migration

---

### Task 2: å‰ç«¯ Dashboard å¯¦ä½œ (AC: 1, 2, 3, 4, 5, 6, 7)

#### 2.1 æ›´æ–°é¡å‹å®šç¾©
- [x] å»ºç«‹ `frontend/src/services/userEventService.ts`
  - [x] `ClubEvent` interface
  - [x] `PaginatedClubEvents` interface
  - [x] `GetUserEventsParams` interface

#### 2.2 å»ºç«‹ API Service
- [x] åœ¨ `frontend/src/services/userEventService.ts` å¯¦ä½œ
  - [x] `getUserClubEvents()` å‡½æ•¸

#### 2.3 å»ºç«‹ RecentEvents å…ƒä»¶
- [x] å»ºç«‹ `frontend/src/components/dashboard/RecentEvents.tsx`
  - [x] ä½¿ç”¨ `getUserClubEvents()` ç²å–æœ€æ–° 3 å€‹æ´»å‹•
  - [x] é¡¯ç¤ºæ´»å‹•å¡ç‰‡ï¼ˆæ´»å‹•åç¨±ã€è®€æ›¸æœƒåç¨±ã€æ™‚é–“ã€åƒèˆ‡äººæ•¸ï¼‰
  - [x] é»æ“Šå¡ç‰‡è·³è½‰åˆ°æ´»å‹•è©³ç´°é é¢
  - [x] é»æ“Šè®€æ›¸æœƒåç¨±è·³è½‰åˆ°è®€æ›¸æœƒé é¢
  - [x] ã€ŒæŸ¥çœ‹å…¨éƒ¨ã€é€£çµè·³è½‰åˆ° `/activities/my-events`
  - [x] ç©ºç‹€æ…‹ã€Loadingã€Error è™•ç†

#### 2.4 æ›´æ–° Dashboard é é¢
- [x] ä¿®æ”¹ `frontend/src/pages/Dashboard.tsx`
  - [x] ç§»é™¤ `ActivityTimeline` import
  - [x] æ–°å¢ `RecentEvents` import
  - [x] æ›¿æ›å…ƒä»¶

---

### Task 3: æˆ‘çš„æ´»å‹•é é¢å¯¦ä½œ (AC: 8)

#### 3.1 å»ºç«‹ MyEvents é é¢
- [x] å»ºç«‹ `frontend/src/pages/activities/MyEvents.tsx`
  - [x] ä½¿ç”¨ `useSearchParams` ç®¡ç†ç¯©é¸å’Œåˆ†é ç‹€æ…‹
  - [x] å¾ URL è®€å–ç¯©é¸æ¢ä»¶
  - [x] ä½¿ç”¨ `getUserClubEvents()` ç²å–æ´»å‹•åˆ—è¡¨
  - [x] é¡¯ç¤ºæ´»å‹•åˆ—è¡¨ï¼ˆå®Œæ•´è³‡è¨Šã€ç‹€æ…‹æ¨™ç±¤ã€å·²å ±åæ¨™ç±¤ï¼‰
  - [x] ç¯©é¸å™¨ï¼ˆæ´»å‹•ç‹€æ…‹ã€åƒèˆ‡ç‹€æ…‹ï¼‰
  - [x] åˆ†é æ§åˆ¶
  - [x] ç©ºç‹€æ…‹ã€è¿”å›å„€è¡¨æ¿æŒ‰éˆ•ã€Loading ç‹€æ…‹

#### 3.2 è¨»å†Šè·¯ç”±
- [x] åœ¨ `frontend/src/App.tsx` æ–°å¢è·¯ç”±
  - [x] Import: `MyEvents`
  - [x] Route: `/activities/my-events` with `<PrivateRoute>` å’Œ `<Layout>`

---

### Task 4: æ¸¬è©¦èˆ‡é©—è­‰ (AC: All)

#### 4.1 å¾Œç«¯å–®å…ƒæ¸¬è©¦
- [ ] å»ºç«‹ `backend/tests/unit/test_user_event_service.py`
  - [ ] æ¸¬è©¦ `get_user_club_events()` åŸºæœ¬æŸ¥è©¢
  - [ ] æ¸¬è©¦ç‹€æ…‹ç¯©é¸åŠŸèƒ½
  - [ ] æ¸¬è©¦åƒèˆ‡ç‹€æ…‹ç¯©é¸åŠŸèƒ½
  - [ ] æ¸¬è©¦åˆ†é åŠŸèƒ½
  - [ ] æ¸¬è©¦è®€æ›¸æœƒç¯©é¸åŠŸèƒ½

#### 4.2 å‰ç«¯æ‰‹å‹•æ¸¬è©¦
- [ ] **Dashboard é¡¯ç¤ºæ¸¬è©¦**
  - [ ] ç™»å…¥å¾Œé€²å…¥ Dashboard
  - [ ] ç¢ºèªã€Œæœ€è¿‘æ´»å‹•ã€å€å¡Šé¡¯ç¤º
  - [ ] ç¢ºèªé¡¯ç¤ºæœ€å¤š 3 å€‹æ´»å‹•
  - [ ] ç¢ºèªæ´»å‹•æŒ‰æ™‚é–“æ’åº
  - [ ] ç¢ºèªå·²å ±åæ´»å‹•æœ‰ç¶ è‰²å‹¾å‹¾æ¨™ç¤º
  - [ ] é»æ“Šæ´»å‹•å¡ç‰‡å¯è·³è½‰åˆ°æ´»å‹•è©³ç´°é é¢
  - [ ] é»æ“Šè®€æ›¸æœƒåç¨±å¯è·³è½‰åˆ°è®€æ›¸æœƒé é¢
  - [ ] é»æ“Šã€ŒæŸ¥çœ‹å…¨éƒ¨ã€å¯è·³è½‰åˆ°æˆ‘çš„æ´»å‹•é é¢

- [ ] **æˆ‘çš„æ´»å‹•é é¢æ¸¬è©¦**
  - [ ] é€²å…¥ `/activities/my-events` é é¢
  - [ ] ç¢ºèªé¡¯ç¤ºæ‰€æœ‰æ´»å‹•
  - [ ] æ¸¬è©¦ã€Œæ´»å‹•ç‹€æ…‹ã€ç¯©é¸åŠŸèƒ½
  - [ ] æ¸¬è©¦ã€Œåƒèˆ‡ç‹€æ…‹ã€ç¯©é¸åŠŸèƒ½
  - [ ] æ¸¬è©¦åˆ†é åŠŸèƒ½
  - [ ] ç¢ºèªç©ºç‹€æ…‹é¡¯ç¤ºæ­£ç¢º
  - [ ] æ¸¬è©¦è¿”å›å„€è¡¨æ¿æŒ‰éˆ•

- [ ] **é‚Šç•Œæƒ…æ³æ¸¬è©¦**
  - [ ] æœªåŠ å…¥ä»»ä½•è®€æ›¸æœƒçš„ä½¿ç”¨è€…
  - [ ] è®€æ›¸æœƒæ²’æœ‰ä»»ä½•æ´»å‹•
  - [ ] æ‰€æœ‰æ´»å‹•éƒ½å·²çµæŸ

---

## ğŸ“ Implementation Details

### å¾Œç«¯å¯¦ä½œç´°ç¯€

**Schema å®šç¾©** (`backend/app/schemas/user_event.py`):
```python
from typing import Optional, List
from datetime import datetime
from pydantic import BaseModel
from app.models.event import EventStatus
from app.schemas.pagination import PaginationMeta

class UserEventRead(BaseModel):
    """ä½¿ç”¨è€…è®€æ›¸æœƒæ´»å‹• Schema"""
    id: int
    title: str
    description: str
    event_datetime: datetime
    meeting_url: str
    club_id: int
    club_name: str
    club_cover_image_url: Optional[str]
    status: EventStatus
    is_registered: bool  # ä½¿ç”¨è€…æ˜¯å¦å·²å ±å
    is_organizer: bool   # ä½¿ç”¨è€…æ˜¯å¦ç‚ºä¸»è¾¦äºº
    current_participants: int
    max_participants: Optional[int]
    created_at: datetime
    
    class Config:
        from_attributes = True

class PaginatedUserEventList(BaseModel):
    """åˆ†é ä½¿ç”¨è€…æ´»å‹•åˆ—è¡¨"""
    items: List[UserEventRead]
    pagination: PaginationMeta
```

**Service Layer æ ¸å¿ƒé‚è¼¯** (`backend/app/services/user_event_service.py`):
```python
def get_user_club_events(
    session: Session,
    user_id: int,
    page: int = 1,
    page_size: int = 20,
    status: Optional[EventStatus] = None,
    participation: Optional[str] = None,
    club_id: Optional[int] = None
) -> Tuple[List[UserEventRead], PaginationMeta]:
    """
    ç²å–ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•
    
    æ­¥é©Ÿï¼š
    1. æŸ¥è©¢ä½¿ç”¨è€…åŠ å…¥çš„è®€æ›¸æœƒ
    2. æŸ¥è©¢é€™äº›è®€æ›¸æœƒçš„æ´»å‹•
    3. Join BookClub å’Œ EventParticipant
    4. å¥—ç”¨ç¯©é¸æ¢ä»¶
    5. æŒ‰æ´»å‹•æ™‚é–“æ’åº
    6. åˆ†é è™•ç†
    7. æŸ¥è©¢ä½¿ç”¨è€…åƒèˆ‡ç‹€æ…‹
    8. çµ„è£å›æ‡‰è³‡æ–™
    """
```

**API Endpoint** (`backend/app/api/endpoints/user_events.py`):
```python
@router.get("/me/events", response_model=PaginatedUserEventList)
def get_my_club_events(
    *,
    session: Session = Depends(get_session),
    current_user: User = Depends(get_current_user),
    page: int = Query(1, ge=1),
    page_size: int = Query(20, ge=1, le=100),
    status: Optional[EventStatus] = Query(None),
    participation: Optional[str] = Query(None),
    club_id: Optional[int] = Query(None)
):
    """ç²å–ç•¶å‰ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•"""
```

### å‰ç«¯å¯¦ä½œç´°ç¯€

**API Service** (`frontend/src/services/userEventService.ts`):
```typescript
export interface GetUserEventsParams {
  page?: number;
  pageSize?: number;
  status?: 'published' | 'completed' | 'cancelled';
  participation?: 'all' | 'registered' | 'not_registered';
  clubId?: number;
}

export const getUserClubEvents = async (
  params?: GetUserEventsParams
): Promise<PaginatedClubEvents> => {
  // å»ºç«‹ query parameters
  // å‘¼å« API
  // è¿”å›è³‡æ–™
};
```

**RecentEvents å…ƒä»¶** (`frontend/src/components/dashboard/RecentEvents.tsx`):
- é¡¯ç¤ºæœ€æ–° 3 å€‹æ´»å‹•
- ä½¿ç”¨ `getImageUrl()` è½‰æ›åœ–ç‰‡è·¯å¾‘
- ä½¿ç”¨ `format()` å’Œ `formatRelativeTime()` æ ¼å¼åŒ–æ™‚é–“
- Loading å’Œ Error ç‹€æ…‹è™•ç†
- ç©ºç‹€æ…‹ UI

**MyEvents é é¢** (`frontend/src/pages/activities/MyEvents.tsx`):
- ä½¿ç”¨ `useSearchParams` ç®¡ç† URL ç‹€æ…‹
- ç¯©é¸å™¨æ§åˆ¶ï¼ˆç‹€æ…‹ã€åƒèˆ‡ï¼‰
- åˆ†é æ§åˆ¶
- æ´»å‹•åˆ—è¡¨é¡¯ç¤º
- éŸ¿æ‡‰å¼è¨­è¨ˆ

---

## ğŸ” é©—æ”¶æ¸¬è©¦

### å¾Œç«¯ API æ¸¬è©¦
```bash
# 1. å•Ÿå‹•å¾Œç«¯æœå‹™
cd backend
docker-compose up -d

# 2. æ¸¬è©¦ API
curl -X GET "http://localhost:8000/api/v1/users/me/events?page=1&page_size=3&status=published" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 3. åŸ·è¡Œå–®å…ƒæ¸¬è©¦
docker exec backend-api-1 pytest tests/unit/test_user_event_service.py -v
```

### å‰ç«¯æ¸¬è©¦
```bash
# 1. å•Ÿå‹•å‰ç«¯
cd frontend
npm run dev

# 2. æ‰‹å‹•æ¸¬è©¦æ‰€æœ‰ AC é …ç›®
```

---

## ğŸ“š ç›¸é—œè³‡æº

- [FastAPI Query Parameters](https://fastapi.tiangolo.com/tutorial/query-params/)
- [SQLModel Relationships](https://sqlmodel.tiangolo.com/tutorial/relationship-attributes/)
- [React Router useSearchParams](https://reactrouter.com/en/main/hooks/use-search-params)
- [date-fns Documentation](https://date-fns.org/)
- Story 2.7 User Story: `docs/stories/2.7-dashboard-recent-events.md`

---

## å®Œæ•´ç¨‹å¼ç¢¼ç¯„ä¾‹

<details>
<summary>ğŸ‘‰ é»æ“Šå±•é–‹å®Œæ•´ç¨‹å¼ç¢¼</summary>

### å¾Œç«¯å®Œæ•´ç¨‹å¼ç¢¼

**1. Service Layer** (`backend/app/services/user_event_service.py`):

```python
from typing import List, Optional, Tuple
from sqlmodel import Session, select, func, or_
from datetime import datetime

from app.models.event import Event, EventStatus, EventParticipant
from app.models.book_club import BookClub
from app.models.book_club_member import BookClubMember
from app.schemas.user_event import UserEventRead
from app.schemas.pagination import PaginationMeta


def get_user_club_events(
    session: Session,
    user_id: int,
    page: int = 1,
    page_size: int = 20,
    status: Optional[EventStatus] = None,
    participation: Optional[str] = None,
    club_id: Optional[int] = None
) -> Tuple[List[UserEventRead], PaginationMeta]:
    """
    ç²å–ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•
    
    Args:
        session: è³‡æ–™åº« session
        user_id: ä½¿ç”¨è€… ID
        page: é ç¢¼
        page_size: æ¯é æ•¸é‡
        status: æ´»å‹•ç‹€æ…‹ç¯©é¸ (published/completed/cancelled)
        participation: åƒèˆ‡ç‹€æ…‹ç¯©é¸ (all/registered/not_registered)
        club_id: è®€æ›¸æœƒ ID ç¯©é¸
    
    Returns:
        (æ´»å‹•åˆ—è¡¨, åˆ†é è³‡è¨Š)
    """
    
    # 1. æŸ¥è©¢ä½¿ç”¨è€…åŠ å…¥çš„è®€æ›¸æœƒ
    user_club_ids_query = select(BookClubMember.book_club_id).where(
        BookClubMember.user_id == user_id
    )
    
    # 2. æŸ¥è©¢é€™äº›è®€æ›¸æœƒçš„æ´»å‹•
    query = (
        select(
            Event,
            BookClub.name.label('club_name'),
            BookClub.cover_image_url.label('club_cover_image_url'),
            func.count(EventParticipant.user_id).label('current_participants')
        )
        .join(BookClub, Event.club_id == BookClub.id)
        .outerjoin(EventParticipant, Event.id == EventParticipant.event_id)
        .where(Event.club_id.in_(user_club_ids_query))
        .group_by(Event.id, BookClub.name, BookClub.cover_image_url)
    )
    
    # 3. å¥—ç”¨ç¯©é¸æ¢ä»¶
    if status:
        query = query.where(Event.status == status)
    
    if club_id:
        query = query.where(Event.club_id == club_id)
    
    # 4. æŒ‰æ´»å‹•æ™‚é–“æ’åºï¼ˆæœªä¾†æ´»å‹•å„ªå…ˆï¼Œç„¶å¾Œæ˜¯æœ€è¿‘çµæŸçš„ï¼‰
    query = query.order_by(Event.event_datetime.asc())
    
    # 5. è¨ˆç®—ç¸½æ•¸ï¼ˆç”¨æ–¼åˆ†é ï¼‰
    count_query = select(func.count()).select_from(
        select(Event.id)
        .where(Event.club_id.in_(user_club_ids_query))
    )
    if status:
        count_query = count_query.where(Event.status == status)
    if club_id:
        count_query = count_query.where(Event.club_id == club_id)
    
    total_items = session.exec(count_query).one()
    
    # 6. åˆ†é 
    offset = (page - 1) * page_size
    query = query.offset(offset).limit(page_size)
    
    results = session.exec(query).all()
    
    # 7. æŸ¥è©¢ä½¿ç”¨è€…åƒèˆ‡ç‹€æ…‹
    event_ids = [result[0].id for result in results]
    user_participations = {}
    if event_ids:
        participation_query = select(EventParticipant.event_id).where(
            EventParticipant.event_id.in_(event_ids),
            EventParticipant.user_id == user_id,
            EventParticipant.status == 'registered'
        )
        user_event_ids = session.exec(participation_query).all()
        user_participations = {event_id: True for event_id in user_event_ids}
    
    # 8. çµ„è£å›æ‡‰è³‡æ–™
    events = []
    for event, club_name, club_cover_image_url, current_participants in results:
        is_registered = event.id in user_participations
        is_organizer = event.organizer_id == user_id
        
        # æ ¹æ“š participation ç¯©é¸
        if participation == 'registered' and not is_registered:
            continue
        if participation == 'not_registered' and is_registered:
            continue
        
        events.append(UserEventRead(
            id=event.id,
            title=event.title,
            description=event.description,
            event_datetime=event.event_datetime,
            meeting_url=event.meeting_url,
            club_id=event.club_id,
            club_name=club_name,
            club_cover_image_url=club_cover_image_url,
            status=event.status,
            is_registered=is_registered,
            is_organizer=is_organizer,
            current_participants=current_participants,
            max_participants=event.max_participants,
            created_at=event.created_at
        ))
    
    # 9. å»ºç«‹åˆ†é è³‡è¨Š
    total_pages = (total_items + page_size - 1) // page_size
    pagination = PaginationMeta(
        page=page,
        page_size=page_size,
        total_items=total_items,
        total_pages=total_pages,
        has_next=page < total_pages,
        has_previous=page > 1
    )
    
    return events, pagination
```

**2. API Endpoint** (`backend/app/api/endpoints/user_events.py`):

```python
from typing import Optional
from fastapi import APIRouter, Depends, Query
from sqlmodel import Session

from app.db.session import get_session
from app.core.security import get_current_user
from app.models.user import User
from app.models.event import EventStatus
from app.schemas.user_event import PaginatedUserEventList
from app.services.user_event_service import get_user_club_events

router = APIRouter()


@router.get("/me/events", response_model=PaginatedUserEventList)
def get_my_club_events(
    *,
    session: Session = Depends(get_session),
    current_user: User = Depends(get_current_user),
    page: int = Query(1, ge=1, description="é ç¢¼ï¼ˆå¾ 1 é–‹å§‹ï¼‰"),
    page_size: int = Query(20, ge=1, le=100, description="æ¯é é …ç›®æ•¸"),
    status: Optional[EventStatus] = Query(None, description="æ´»å‹•ç‹€æ…‹ç¯©é¸"),
    participation: Optional[str] = Query(
        None, 
        description="åƒèˆ‡ç‹€æ…‹ç¯©é¸ (all/registered/not_registered)"
    ),
    club_id: Optional[int] = Query(None, description="è®€æ›¸æœƒ ID ç¯©é¸")
):
    """
    ç²å–ç•¶å‰ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•
    
    - åŒ…å«ä½¿ç”¨è€…æ‰€æœ‰è®€æ›¸æœƒçš„æ´»å‹•
    - å¯ä¾ç‹€æ…‹ã€åƒèˆ‡æƒ…æ³ã€è®€æ›¸æœƒç¯©é¸
    - æ”¯æ´åˆ†é 
    """
    events, pagination = get_user_club_events(
        session=session,
        user_id=current_user.id,
        page=page,
        page_size=page_size,
        status=status,
        participation=participation,
        club_id=club_id
    )
    
    return PaginatedUserEventList(
        items=events,
        pagination=pagination
    )
```

**3. Database Migration** (`backend/alembic/versions/xxxx_add_event_indexes.py`):

```python
"""add event indexes for performance

Revision ID: xxxx
"""
from alembic import op


def upgrade() -> None:
    # ç‚ºå¸¸ç”¨æŸ¥è©¢æ¬„ä½æ·»åŠ ç´¢å¼•
    op.create_index('ix_event_datetime', 'event', ['event_datetime'])
    op.create_index('ix_event_club_id_status', 'event', ['club_id', 'status'])


def downgrade() -> None:
    op.drop_index('ix_event_datetime', 'event')
    op.drop_index('ix_event_club_id_status', 'event')
```

### å‰ç«¯å®Œæ•´ç¨‹å¼ç¢¼

**1. Type Definitions** (`frontend/src/types/event.ts`):

```typescript
export interface ClubEvent {
  id: number;
  title: string;
  description: string;
  eventDatetime: string;
  meetingUrl: string;
  clubId: number;
  clubName: string;
  clubCoverImageUrl: string | null;
  status: 'published' | 'completed' | 'cancelled';
  isRegistered: boolean;
  isOrganizer: boolean;
  currentParticipants: number;
  maxParticipants: number | null;
  createdAt: string;
}

export interface PaginatedClubEvents {
  items: ClubEvent[];
  pagination: {
    page: number;
    pageSize: number;
    totalItems: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**2. API Service** (`frontend/src/services/userEventService.ts`):

```typescript
import api from './apiClient';
import type { ClubEvent, PaginatedClubEvents } from '../types/event';

export interface GetUserEventsParams {
  page?: number;
  pageSize?: number;
  status?: 'published' | 'completed' | 'cancelled';
  participation?: 'all' | 'registered' | 'not_registered';
  clubId?: number;
}

/**
 * ç²å–ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ´»å‹•
 */
export const getUserClubEvents = async (
  params?: GetUserEventsParams
): Promise<PaginatedClubEvents> => {
  const queryParams = new URLSearchParams();
  
  if (params?.page) queryParams.append('page', params.page.toString());
  if (params?.pageSize) queryParams.append('page_size', params.pageSize.toString());
  if (params?.status) queryParams.append('status', params.status);
  if (params?.participation) queryParams.append('participation', params.participation);
  if (params?.clubId) queryParams.append('club_id', params.clubId.toString());
  
  const response = await api.get<PaginatedClubEvents>(
    `/api/v1/users/me/events${queryParams.toString() ? '?' + queryParams.toString() : ''}`
  );
  
  return response.data;
};

export default {
  getUserClubEvents,
};
```

**3. RecentEvents Component** (`frontend/src/components/dashboard/RecentEvents.tsx`):

```typescript
import { useEffect, useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { Card } from '../ui/Card';
import { getUserClubEvents } from '../../services/userEventService';
import { getImageUrl } from '../../utils/imageUrl';
import { formatRelativeTime } from '../../utils/dateFormatter';
import type { ClubEvent } from '../../types/event';
import { format } from 'date-fns';
import { zhTW } from 'date-fns/locale';

export const RecentEvents = () => {
  const navigate = useNavigate();
  const [events, setEvents] = useState<ClubEvent[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadEvents();
  }, []);

  const loadEvents = async () => {
    try {
      setLoading(true);
      const response = await getUserClubEvents({
        page: 1,
        pageSize: 3,
        status: 'published'
      });
      setEvents(response.items);
    } catch (err: any) {
      setError(err.message || 'è¼‰å…¥æ´»å‹•å¤±æ•—');
    } finally {
      setLoading(false);
    }
  };

  const getEventStatusBadge = (event: ClubEvent) => {
    const eventDate = new Date(event.eventDatetime);
    const now = new Date();
    const isPast = eventDate < now;

    if (isPast) {
      return <span className="text-xs text-gray-500">å·²çµæŸ</span>;
    }

    return (
      <span className="text-xs text-blue-600 font-medium">å³å°‡èˆ‰è¡Œ</span>
    );
  };

  const getParticipantsDisplay = (event: ClubEvent) => {
    if (event.maxParticipants === null || event.maxParticipants === 0) {
      return `${event.currentParticipants}äººå·²å ±å`;
    }
    return `${event.currentParticipants}/${event.maxParticipants}äºº`;
  };

  if (loading) {
    return (
      <Card>
        <h3 className="text-lg font-semibold text-gray-900 mb-4">æœ€è¿‘æ´»å‹•</h3>
        <div className="space-y-3">
          {[1, 2, 3].map((i) => (
            <div key={i} className="animate-pulse">
              <div className="h-20 bg-gray-200 rounded-lg"></div>
            </div>
          ))}
        </div>
      </Card>
    );
  }

  if (error) {
    return (
      <Card>
        <h3 className="text-lg font-semibold text-gray-900 mb-4">æœ€è¿‘æ´»å‹•</h3>
        <div className="text-center py-8 text-red-500">
          <p>{error}</p>
        </div>
      </Card>
    );
  }

  return (
    <Card>
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-lg font-semibold text-gray-900">æœ€è¿‘æ´»å‹•</h3>
        {events.length > 0 && (
          <Link
            to="/activities/my-events"
            className="text-blue-600 hover:text-blue-700 text-sm font-medium hover:underline"
          >
            æŸ¥çœ‹å…¨éƒ¨
          </Link>
        )}
      </div>

      {events.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          <p className="text-4xl mb-2">ğŸ“…</p>
          <p className="mb-2">ç›®å‰æ²’æœ‰å³å°‡èˆ‰è¡Œçš„æ´»å‹•</p>
          <Link
            to="/clubs"
            className="inline-block mt-3 text-blue-600 hover:text-blue-700 text-sm font-medium hover:underline"
          >
            æ¢ç´¢è®€æ›¸æœƒ â†’
          </Link>
        </div>
      ) : (
        <div className="space-y-3">
          {events.map((event) => (
            <div
              key={event.id}
              onClick={() => navigate(`/clubs/${event.clubId}/events/${event.id}`)}
              className="block p-4 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer"
            >
              <div className="flex items-start justify-between">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-1">
                    <h4 className="font-semibold text-gray-900 truncate">
                      ğŸ“… {event.title}
                    </h4>
                    {event.isRegistered && (
                      <span className="inline-flex items-center text-green-600 text-xs">
                        <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                        </svg>
                      </span>
                    )}
                  </div>
                  
                  <Link
                    to={`/clubs/${event.clubId}`}
                    onClick={(e) => e.stopPropagation()}
                    className="text-sm text-blue-600 hover:text-blue-700 hover:underline mb-2 inline-block"
                  >
                    ğŸ“š {event.clubName}
                  </Link>
                  
                  <div className="flex flex-wrap items-center gap-3 text-sm text-gray-600">
                    <span className="flex items-center">
                      ğŸ•’ {format(new Date(event.eventDatetime), 'MM/dd HH:mm', { locale: zhTW })}
                      <span className="ml-1 text-xs">
                        ({formatRelativeTime(event.eventDatetime)})
                      </span>
                    </span>
                    <span>ğŸ‘¥ {getParticipantsDisplay(event)}</span>
                    {getEventStatusBadge(event)}
                  </div>
                </div>
                
                {event.clubCoverImageUrl && (
                  <img
                    src={getImageUrl(event.clubCoverImageUrl) || ''}
                    alt={event.clubName}
                    className="w-12 h-12 rounded object-cover ml-4 flex-shrink-0"
                  />
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </Card>
  );
};
```

**4. MyEvents Page** (`frontend/src/pages/activities/MyEvents.tsx`):

```typescript
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { getUserClubEvents } from '../../services/userEventService';
import { getImageUrl } from '../../utils/imageUrl';
import type { ClubEvent } from '../../types/event';
import { format } from 'date-fns';
import { zhTW } from 'date-fns/locale';
import { Button } from '../../components/ui/Button';

export default function MyEvents() {
  const navigate = useNavigate();
  const [searchParams, setSearchParams] = useSearchParams();
  const [events, setEvents] = useState<ClubEvent[]>([]);
  const [loading, setLoading] = useState(true);
  const [page, setPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  
  // ç¯©é¸ç‹€æ…‹
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [participationFilter, setParticipationFilter] = useState<string>('all');

  useEffect(() => {
    // å¾ URL åƒæ•¸è®€å–ç¯©é¸æ¢ä»¶
    const status = searchParams.get('status') || 'all';
    const participation = searchParams.get('participation') || 'all';
    const pageNum = parseInt(searchParams.get('page') || '1');
    
    setStatusFilter(status);
    setParticipationFilter(participation);
    setPage(pageNum);
    
    loadEvents(pageNum, status, participation);
  }, [searchParams]);

  const loadEvents = async (
    pageNum: number,
    status: string,
    participation: string
  ) => {
    try {
      setLoading(true);
      const response = await getUserClubEvents({
        page: pageNum,
        pageSize: 20,
        status: status === 'all' ? undefined : status as any,
        participation: participation === 'all' ? undefined : participation as any,
      });
      setEvents(response.items);
      setTotalPages(response.pagination.totalPages);
    } catch (err: any) {
      console.error('è¼‰å…¥æ´»å‹•å¤±æ•—:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleFilterChange = (filterType: 'status' | 'participation', value: string) => {
    const newParams = new URLSearchParams(searchParams);
    newParams.set(filterType, value);
    newParams.set('page', '1'); // é‡ç½®åˆ°ç¬¬ä¸€é 
    setSearchParams(newParams);
  };

  const handlePageChange = (newPage: number) => {
    const newParams = new URLSearchParams(searchParams);
    newParams.set('page', newPage.toString());
    setSearchParams(newParams);
  };

  const getEventStatusBadge = (event: ClubEvent) => {
    const eventDate = new Date(event.eventDatetime);
    const now = new Date();
    const isPast = eventDate < now;

    if (isPast) {
      return (
        <span className="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-600">
          å·²çµæŸ
        </span>
      );
    }

    return (
      <span className="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-600">
          å³å°‡èˆ‰è¡Œ
        </span>
    );
  };

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="mb-6">
          <Button
            onClick={() => navigate('/dashboard')}
            variant="outline"
            className="mb-4"
          >
            â† è¿”å›å„€è¡¨æ¿
          </Button>
          <h1 className="text-3xl font-bold text-gray-900">æˆ‘çš„æ´»å‹•</h1>
          <p className="text-gray-600 mt-2">ç€è¦½æ‚¨åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•</p>
        </div>

        {/* Filters */}
        <div className="bg-white rounded-lg shadow-sm p-4 mb-6">
          <div className="flex flex-wrap gap-4">
            {/* ç‹€æ…‹ç¯©é¸ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                æ´»å‹•ç‹€æ…‹
              </label>
              <select
                value={statusFilter}
                onChange={(e) => handleFilterChange('status', e.target.value)}
                className="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="all">å…¨éƒ¨</option>
                <option value="published">å³å°‡èˆ‰è¡Œ</option>
                <option value="completed">å·²çµæŸ</option>
                <option value="cancelled">å·²å–æ¶ˆ</option>
              </select>
            </div>

            {/* åƒèˆ‡ç‹€æ…‹ç¯©é¸ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                åƒèˆ‡ç‹€æ…‹
              </label>
              <select
                value={participationFilter}
                onChange={(e) => handleFilterChange('participation', e.target.value)}
                className="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="all">å…¨éƒ¨</option>
                <option value="registered">å·²å ±å</option>
                <option value="not_registered">æœªå ±å</option>
              </select>
            </div>
          </div>
        </div>

        {/* Events List */}
        {loading ? (
          <div className="space-y-4">
            {[1, 2, 3].map((i) => (
              <div key={i} className="bg-white rounded-lg shadow-sm p-6 animate-pulse">
                <div className="h-6 bg-gray-200 rounded w-3/4 mb-4"></div>
                <div className="h-4 bg-gray-200 rounded w-1/2"></div>
              </div>
            ))}
          </div>
        ) : events.length === 0 ? (
          <div className="bg-white rounded-lg shadow-sm p-12 text-center">
            <p className="text-4xl mb-4">ğŸ“…</p>
            <p className="text-gray-600 mb-4">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ´»å‹•</p>
            <Button onClick={() => navigate('/clubs')} variant="primary">
              æ¢ç´¢è®€æ›¸æœƒ
            </Button>
          </div>
        ) : (
          <>
            <div className="space-y-4 mb-6">
              {events.map((event) => (
                <div
                  key={event.id}
                  onClick={() => navigate(`/clubs/${event.clubId}/events/${event.id}`)}
                  className="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow cursor-pointer"
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-3 mb-2">
                        <h3 className="text-xl font-semibold text-gray-900">
                          {event.title}
                        </h3>
                        {event.isRegistered && (
                          <span className="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-600">
                            âœ“ å·²å ±å
                          </span>
                        )}
                        {getEventStatusBadge(event)}
                      </div>

                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          navigate(`/clubs/${event.clubId}`);
                        }}
                        className="text-blue-600 hover:text-blue-700 hover:underline mb-3 inline-block"
                      >
                        ğŸ“š {event.clubName}
                      </button>

                      <div className="flex flex-wrap items-center gap-4 text-sm text-gray-600">
                        <span className="flex items-center">
                          ğŸ•’ {format(new Date(event.eventDatetime), 'yyyyå¹´Mæœˆdæ—¥ HH:mm', { locale: zhTW })}
                        </span>
                        <span className="flex items-center">
                          ğŸ‘¥ {event.currentParticipants}
                          {event.maxParticipants && event.maxParticipants > 0 && ` / ${event.maxParticipants}`} äºº
                        </span>
                      </div>

                      <p className="mt-3 text-gray-600 text-sm line-clamp-2">
                        {event.description}
                      </p>
                    </div>

                    {event.clubCoverImageUrl && (
                      <img
                        src={getImageUrl(event.clubCoverImageUrl) || ''}
                        alt={event.clubName}
                        className="w-20 h-20 rounded-lg object-cover ml-6 flex-shrink-0"
                      />
                    )}
                  </div>
                </div>
              ))}
            </div>

            {/* Pagination */}
            {totalPages > 1 && (
              <div className="flex items-center justify-center gap-2">
                <Button
                  onClick={() => handlePageChange(page - 1)}
                  disabled={page === 1}
                  variant="outline"
                >
                  ä¸Šä¸€é 
                </Button>
                <span className="text-gray-600">
                  ç¬¬ {page} / {totalPages} é 
                </span>
                <Button
                  onClick={() => handlePageChange(page + 1)}
                  disabled={page === totalPages}
                  variant="outline"
                >
                  ä¸‹ä¸€é 
                </Button>
              </div>
            )}
          </>
        )}
      </div>
    </div>
  );
}
```

</details>

---

## ğŸ” Testing Checklist

åŸ·è¡Œæ¸¬è©¦ä»¥ç¢ºèªåŠŸèƒ½å®Œæˆï¼š

```bash
# å¾Œç«¯æ¸¬è©¦
cd backend
docker exec backend-api-1 pytest tests/unit/test_user_event_service.py -v

# è³‡æ–™åº« Migration
docker exec backend-api-1 alembic revision --autogenerate -m "add event indexes"
docker exec backend-api-1 alembic upgrade head

# å•Ÿå‹•æœå‹™
docker-compose up -d

# æ¸¬è©¦ API
curl -X GET "http://localhost:8000/api/v1/users/me/events?page=1&page_size=3" \
  -H "Authorization: Bearer YOUR_TOKEN"

# å‰ç«¯æ¸¬è©¦
cd frontend
npm run dev
```

---

**æ³¨æ„äº‹é …**:
- å¯¦ä½œå‰è«‹å…ˆé–±è®€ `docs/stories/2.7-dashboard-recent-events.md` äº†è§£å®Œæ•´éœ€æ±‚
- ç¢ºä¿å¾Œç«¯ API å®Œæˆä¸¦æ¸¬è©¦é€šéå¾Œå†é–‹å§‹å‰ç«¯é–‹ç™¼
- ä½¿ç”¨ç¾æœ‰çš„ `getImageUrl()` utility è™•ç†åœ–ç‰‡è·¯å¾‘
- å‰ç«¯ä½¿ç”¨ `formatRelativeTime()` é¡¯ç¤ºç›¸å°æ™‚é–“
- æ‰€æœ‰æ™‚é–“ä½¿ç”¨ `date-fns` æ ¼å¼åŒ–ï¼Œlocale è¨­ç‚º `zhTW`
from typing import Optional, List
from datetime import datetime
from pydantic import BaseModel
from app.models.event import EventStatus
from app.schemas.pagination import PaginationMeta

class UserEventRead(BaseModel):
    """ä½¿ç”¨è€…è®€æ›¸æœƒæ´»å‹• Schema"""
    id: int
    title: str
    description: str
    event_datetime: datetime
    meeting_url: str
    club_id: int
    club_name: str
    club_cover_image_url: Optional[str]
    status: EventStatus
    is_registered: bool  # ä½¿ç”¨è€…æ˜¯å¦å·²å ±å
    is_organizer: bool   # ä½¿ç”¨è€…æ˜¯å¦ç‚ºä¸»è¾¦äºº
    current_participants: int
    max_participants: Optional[int]
    created_at: datetime
    
    class Config:
        from_attributes = True

class PaginatedUserEventList(BaseModel):
    """åˆ†é ä½¿ç”¨è€…æ´»å‹•åˆ—è¡¨"""
    items: List[UserEventRead]
    pagination: PaginationMeta
```

### 1.2 å»ºç«‹ Service Layer

**æª”æ¡ˆ**: `backend/app/services/user_event_service.py` (æ–°å»º)

```python
from typing import List, Optional, Tuple
from sqlmodel import Session, select, func, or_
from datetime import datetime

from app.models.event import Event, EventStatus, EventParticipant
from app.models.book_club import BookClub
from app.models.book_club_member import BookClubMember
from app.schemas.user_event import UserEventRead
from app.schemas.pagination import PaginationMeta


def get_user_club_events(
    session: Session,
    user_id: int,
    page: int = 1,
    page_size: int = 20,
    status: Optional[EventStatus] = None,
    participation: Optional[str] = None,
    club_id: Optional[int] = None
) -> Tuple[List[UserEventRead], PaginationMeta]:
    """
    ç²å–ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•
    
    Args:
        session: è³‡æ–™åº« session
        user_id: ä½¿ç”¨è€… ID
        page: é ç¢¼
        page_size: æ¯é æ•¸é‡
        status: æ´»å‹•ç‹€æ…‹ç¯©é¸ (published/completed/cancelled)
        participation: åƒèˆ‡ç‹€æ…‹ç¯©é¸ (all/registered/not_registered)
        club_id: è®€æ›¸æœƒ ID ç¯©é¸
    
    Returns:
        (æ´»å‹•åˆ—è¡¨, åˆ†é è³‡è¨Š)
    """
    
    # 1. æŸ¥è©¢ä½¿ç”¨è€…åŠ å…¥çš„è®€æ›¸æœƒ
    user_club_ids_query = select(BookClubMember.book_club_id).where(
        BookClubMember.user_id == user_id
    )
    
    # 2. æŸ¥è©¢é€™äº›è®€æ›¸æœƒçš„æ´»å‹•
    query = (
        select(
            Event,
            BookClub.name.label('club_name'),
            BookClub.cover_image_url.label('club_cover_image_url'),
            func.count(EventParticipant.user_id).label('current_participants')
        )
        .join(BookClub, Event.club_id == BookClub.id)
        .outerjoin(EventParticipant, Event.id == EventParticipant.event_id)
        .where(Event.club_id.in_(user_club_ids_query))
        .group_by(Event.id, BookClub.name, BookClub.cover_image_url)
    )
    
    # 3. å¥—ç”¨ç¯©é¸æ¢ä»¶
    if status:
        query = query.where(Event.status == status)
    
    if club_id:
        query = query.where(Event.club_id == club_id)
    
    # 4. æŒ‰æ´»å‹•æ™‚é–“æ’åºï¼ˆæœªä¾†æ´»å‹•å„ªå…ˆï¼Œç„¶å¾Œæ˜¯æœ€è¿‘çµæŸçš„ï¼‰
    query = query.order_by(Event.event_datetime.asc())
    
    # 5. è¨ˆç®—ç¸½æ•¸ï¼ˆç”¨æ–¼åˆ†é ï¼‰
    count_query = select(func.count()).select_from(
        select(Event.id)
        .where(Event.club_id.in_(user_club_ids_query))
    )
    if status:
        count_query = count_query.where(Event.status == status)
    if club_id:
        count_query = count_query.where(Event.club_id == club_id)
    
    total_items = session.exec(count_query).one()
    
    # 6. åˆ†é 
    offset = (page - 1) * page_size
    query = query.offset(offset).limit(page_size)
    
    results = session.exec(query).all()
    
    # 7. æŸ¥è©¢ä½¿ç”¨è€…åƒèˆ‡ç‹€æ…‹
    event_ids = [result[0].id for result in results]
    user_participations = {}
    if event_ids:
        participation_query = select(EventParticipant.event_id).where(
            EventParticipant.event_id.in_(event_ids),
            EventParticipant.user_id == user_id,
            EventParticipant.status == 'registered'
        )
        user_event_ids = session.exec(participation_query).all()
        user_participations = {event_id: True for event_id in user_event_ids}
    
    # 8. çµ„è£å›æ‡‰è³‡æ–™
    events = []
    for event, club_name, club_cover_image_url, current_participants in results:
        is_registered = event.id in user_participations
        is_organizer = event.organizer_id == user_id
        
        # æ ¹æ“š participation ç¯©é¸
        if participation == 'registered' and not is_registered:
            continue
        if participation == 'not_registered' and is_registered:
            continue
        
        events.append(UserEventRead(
            id=event.id,
            title=event.title,
            description=event.description,
            event_datetime=event.event_datetime,
            meeting_url=event.meeting_url,
            club_id=event.club_id,
            club_name=club_name,
            club_cover_image_url=club_cover_image_url,
            status=event.status,
            is_registered=is_registered,
            is_organizer=is_organizer,
            current_participants=current_participants,
            max_participants=event.max_participants,
            created_at=event.created_at
        ))
    
    # 9. å»ºç«‹åˆ†é è³‡è¨Š
    total_pages = (total_items + page_size - 1) // page_size
    pagination = PaginationMeta(
        page=page,
        page_size=page_size,
        total_items=total_items,
        total_pages=total_pages,
        has_next=page < total_pages,
        has_previous=page > 1
    )
    
    return events, pagination
```

### 1.3 å»ºç«‹ API Endpoint

**æª”æ¡ˆ**: `backend/app/api/endpoints/user_events.py` (æ–°å»º)

```python
from typing import Optional
from fastapi import APIRouter, Depends, Query
from sqlmodel import Session

from app.db.session import get_session
from app.core.security import get_current_user
from app.models.user import User
from app.models.event import EventStatus
from app.schemas.user_event import PaginatedUserEventList
from app.services.user_event_service import get_user_club_events

router = APIRouter()


@router.get("/me/events", response_model=PaginatedUserEventList)
def get_my_club_events(
    *,
    session: Session = Depends(get_session),
    current_user: User = Depends(get_current_user),
    page: int = Query(1, ge=1, description="é ç¢¼ï¼ˆå¾ 1 é–‹å§‹ï¼‰"),
    page_size: int = Query(20, ge=1, le=100, description="æ¯é é …ç›®æ•¸"),
    status: Optional[EventStatus] = Query(None, description="æ´»å‹•ç‹€æ…‹ç¯©é¸"),
    participation: Optional[str] = Query(
        None, 
        description="åƒèˆ‡ç‹€æ…‹ç¯©é¸ (all/registered/not_registered)"
    ),
    club_id: Optional[int] = Query(None, description="è®€æ›¸æœƒ ID ç¯©é¸")
):
    """
    ç²å–ç•¶å‰ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•
    
    - åŒ…å«ä½¿ç”¨è€…æ‰€æœ‰è®€æ›¸æœƒçš„æ´»å‹•
    - å¯ä¾ç‹€æ…‹ã€åƒèˆ‡æƒ…æ³ã€è®€æ›¸æœƒç¯©é¸
    - æ”¯æ´åˆ†é 
    """
    events, pagination = get_user_club_events(
        session=session,
        user_id=current_user.id,
        page=page,
        page_size=page_size,
        status=status,
        participation=participation,
        club_id=club_id
    )
    
    return PaginatedUserEventList(
        items=events,
        pagination=pagination
    )
```

### 1.4 è¨»å†Šè·¯ç”±

**æª”æ¡ˆ**: `backend/app/api/endpoints/__init__.py`

```python
# åœ¨æª”æ¡ˆä¸­æ·»åŠ 
from app.api.endpoints import user_events

# åœ¨ app/main.py ä¸­è¨»å†Š
app.include_router(
    user_events.router,
    prefix="/api/v1/users",
    tags=["users"]
)
```

### 1.5 è³‡æ–™åº«ç´¢å¼•å„ªåŒ–

**æª”æ¡ˆ**: `backend/alembic/versions/xxxx_add_event_indexes.py` (æ–°å»º migration)

```python
"""add event indexes for performance

Revision ID: xxxx
"""
from alembic import op


def upgrade() -> None:
    # ç‚ºå¸¸ç”¨æŸ¥è©¢æ¬„ä½æ·»åŠ ç´¢å¼•
    op.create_index('ix_event_datetime', 'event', ['event_datetime'])
    op.create_index('ix_event_club_id_status', 'event', ['club_id', 'status'])


def downgrade() -> None:
    op.drop_index('ix_event_datetime', 'event')
    op.drop_index('ix_event_club_id_status', 'event')
```

åŸ·è¡Œ migration:
```bash
cd backend
docker exec backend-api-1 alembic revision --autogenerate -m "add event indexes for performance"
docker exec backend-api-1 alembic upgrade head
```

---

## ğŸ¯ Phase 2: å‰ç«¯ Dashboard å¯¦ä½œ (2-3 å°æ™‚)

### 2.1 æ›´æ–°é¡å‹å®šç¾©

**æª”æ¡ˆ**: `frontend/src/types/event.ts`

```typescript
export interface ClubEvent {
  id: number;
  title: string;
  description: string;
  eventDatetime: string;
  meetingUrl: string;
  clubId: number;
  clubName: string;
  clubCoverImageUrl: string | null;
  status: 'published' | 'completed' | 'cancelled';
  isRegistered: boolean;
  isOrganizer: boolean;
  currentParticipants: number;
  maxParticipants: number | null;
  createdAt: string;
}

export interface PaginatedClubEvents {
  items: ClubEvent[];
  pagination: {
    page: number;
    pageSize: number;
    totalItems: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

### 2.2 å»ºç«‹ API Service

**æª”æ¡ˆ**: `frontend/src/services/userEventService.ts` (æ–°å»º)

```typescript
import api from './apiClient';
import type { ClubEvent, PaginatedClubEvents } from '../types/event';

export interface GetUserEventsParams {
  page?: number;
  pageSize?: number;
  status?: 'published' | 'completed' | 'cancelled';
  participation?: 'all' | 'registered' | 'not_registered';
  clubId?: number;
}

/**
 * ç²å–ä½¿ç”¨è€…åƒèˆ‡è®€æ›¸æœƒçš„æ´»å‹•
 */
export const getUserClubEvents = async (
  params?: GetUserEventsParams
): Promise<PaginatedClubEvents> => {
  const queryParams = new URLSearchParams();
  
  if (params?.page) queryParams.append('page', params.page.toString());
  if (params?.pageSize) queryParams.append('page_size', params.pageSize.toString());
  if (params?.status) queryParams.append('status', params.status);
  if (params?.participation) queryParams.append('participation', params.participation);
  if (params?.clubId) queryParams.append('club_id', params.clubId.toString());
  
  const response = await api.get<PaginatedClubEvents>(
    `/api/v1/users/me/events${queryParams.toString() ? '?' + queryParams.toString() : ''}`
  );
  
  return response.data;
};

export default {
  getUserClubEvents,
};
```

### 2.3 å»ºç«‹ RecentEvents å…ƒä»¶

**æª”æ¡ˆ**: `frontend/src/components/dashboard/RecentEvents.tsx` (æ–°å»º)

```typescript
import { useEffect, useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { Card } from '../ui/Card';
import { getUserClubEvents } from '../../services/userEventService';
import { getImageUrl } from '../../utils/imageUrl';
import { formatRelativeTime } from '../../utils/dateFormatter';
import type { ClubEvent } from '../../types/event';
import { format } from 'date-fns';
import { zhTW } from 'date-fns/locale';

export const RecentEvents = () => {
  const navigate = useNavigate();
  const [events, setEvents] = useState<ClubEvent[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadEvents();
  }, []);

  const loadEvents = async () => {
    try {
      setLoading(true);
      const response = await getUserClubEvents({
        page: 1,
        pageSize: 3,
        status: 'published'
      });
      setEvents(response.items);
    } catch (err: any) {
      setError(err.message || 'è¼‰å…¥æ´»å‹•å¤±æ•—');
    } finally {
      setLoading(false);
    }
  };

  const getEventStatusBadge = (event: ClubEvent) => {
    const eventDate = new Date(event.eventDatetime);
    const now = new Date();
    const isPast = eventDate < now;

    if (isPast) {
      return <span className="text-xs text-gray-500">å·²çµæŸ</span>;
    }

    return (
      <span className="text-xs text-blue-600 font-medium">å³å°‡èˆ‰è¡Œ</span>
    );
  };

  const getParticipantsDisplay = (event: ClubEvent) => {
    if (event.maxParticipants === null || event.maxParticipants === 0) {
      return `${event.currentParticipants}äººå·²å ±å`;
    }
    return `${event.currentParticipants}/${event.maxParticipants}äºº`;
  };

  if (loading) {
    return (
      <Card>
        <h3 className="text-lg font-semibold text-gray-900 mb-4">æœ€è¿‘æ´»å‹•</h3>
        <div className="space-y-3">
          {[1, 2, 3].map((i) => (
            <div key={i} className="animate-pulse">
              <div className="h-20 bg-gray-200 rounded-lg"></div>
            </div>
          ))}
        </div>
      </Card>
    );
  }

  if (error) {
    return (
      <Card>
        <h3 className="text-lg font-semibold text-gray-900 mb-4">æœ€è¿‘æ´»å‹•</h3>
        <div className="text-center py-8 text-red-500">
          <p>{error}</p>
        </div>
      </Card>
    );
  }

  return (
    <Card>
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-lg font-semibold text-gray-900">æœ€è¿‘æ´»å‹•</h3>
        {events.length > 0 && (
          <Link
            to="/activities/my-events"
            className="text-blue-600 hover:text-blue-700 text-sm font-medium hover:underline"
          >
            æŸ¥çœ‹å…¨éƒ¨
          </Link>
        )}
      </div>

      {events.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          <p className="text-4xl mb-2">ï¿½ï¿½</p>
          <p className="mb-2">ç›®å‰æ²’æœ‰å³å°‡èˆ‰è¡Œçš„æ´»å‹•</p>
          <Link
            to="/clubs"
            className="inline-block mt-3 text-blue-600 hover:text-blue-700 text-sm font-medium hover:underline"
          >
            æ¢ç´¢è®€æ›¸æœƒ â†’
          </Link>
        </div>
      ) : (
        <div className="space-y-3">
          {events.map((event) => (
            <div
              key={event.id}
              onClick={() => navigate(`/clubs/${event.clubId}/events/${event.id}`)}
              className="block p-4 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer"
            >
              <div className="flex items-start justify-between">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-1">
                    <h4 className="font-semibold text-gray-900 truncate">
                      ğŸ“… {event.title}
                    </h4>
                    {event.isRegistered && (
                      <span className="inline-flex items-center text-green-600 text-xs">
                        <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                        </svg>
                      </span>
                    )}
                  </div>
                  
                  <Link
                    to={`/clubs/${event.clubId}`}
                    onClick={(e) => e.stopPropagation()}
                    className="text-sm text-blue-600 hover:text-blue-700 hover:underline mb-2 inline-block"
                  >
                    ğŸ“š {event.clubName}
                  </Link>
                  
                  <div className="flex flex-wrap items-center gap-3 text-sm text-gray-600">
                    <span className="flex items-center">
                      ğŸ•’ {format(new Date(event.eventDatetime), 'MM/dd HH:mm', { locale: zhTW })}
                      <span className="ml-1 text-xs">
                        ({formatRelativeTime(event.eventDatetime)})
                      </span>
                    </span>
                    <span>ğŸ‘¥ {getParticipantsDisplay(event)}</span>
                    {getEventStatusBadge(event)}
                  </div>
                </div>
                
                {event.clubCoverImageUrl && (
                  <img
                    src={getImageUrl(event.clubCoverImageUrl) || ''}
                    alt={event.clubName}
                    className="w-12 h-12 rounded object-cover ml-4 flex-shrink-0"
                  />
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </Card>
  );
};
```

### 2.4 æ›´æ–° Dashboard

**æª”æ¡ˆ**: `frontend/src/pages/Dashboard.tsx`

æ‰¾åˆ° `ActivityTimeline` å…ƒä»¶çš„ä½¿ç”¨ï¼Œæ›¿æ›ç‚º `RecentEvents`:

```typescript
// ç§»é™¤
import { ActivityTimeline } from '../components/dashboard/ActivityTimeline';

// æ–°å¢
import { RecentEvents } from '../components/dashboard/RecentEvents';

// åœ¨ render ä¸­æ›¿æ›
<RecentEvents />  // æ›¿æ›åŸæœ¬çš„ <ActivityTimeline activities={dashboard.recentActivities} />
```

---

## ğŸ¯ Phase 3: æˆ‘çš„æ´»å‹•é é¢ (2-3 å°æ™‚)

### 3.1 å»ºç«‹ MyEvents é é¢

**æª”æ¡ˆ**: `frontend/src/pages/activities/MyEvents.tsx` (æ–°å»º)

```typescript
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { getUserClubEvents } from '../../services/userEventService';
import { getImageUrl } from '../../utils/imageUrl';
import type { ClubEvent } from '../../types/event';
import { format } from 'date-fns';
import { zhTW } from 'date-fns/locale';
import { Button } from '../../components/ui/Button';

export default function MyEvents() {
  const navigate = useNavigate();
  const [searchParams, setSearchParams] = useSearchParams();
  const [events, setEvents] = useState<ClubEvent[]>([]);
  const [loading, setLoading] = useState(true);
  const [page, setPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  
  // ç¯©é¸ç‹€æ…‹
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [participationFilter, setParticipationFilter] = useState<string>('all');

  useEffect(() => {
    // å¾ URL åƒæ•¸è®€å–ç¯©é¸æ¢ä»¶
    const status = searchParams.get('status') || 'all';
    const participation = searchParams.get('participation') || 'all';
    const pageNum = parseInt(searchParams.get('page') || '1');
    
    setStatusFilter(status);
    setParticipationFilter(participation);
    setPage(pageNum);
    
    loadEvents(pageNum, status, participation);
  }, [searchParams]);

  const loadEvents = async (
    pageNum: number,
    status: string,
    participation: string
  ) => {
    try {
      setLoading(true);
      const response = await getUserClubEvents({
        page: pageNum,
        pageSize: 20,
        status: status === 'all' ? undefined : status as any,
        participation: participation === 'all' ? undefined : participation as any,
      });
      setEvents(response.items);
      setTotalPages(response.pagination.totalPages);
    } catch (err: any) {
      console.error('è¼‰å…¥æ´»å‹•å¤±æ•—:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleFilterChange = (filterType: 'status' | 'participation', value: string) => {
    const newParams = new URLSearchParams(searchParams);
    newParams.set(filterType, value);
    newParams.set('page', '1'); // é‡ç½®åˆ°ç¬¬ä¸€é 
    setSearchParams(newParams);
  };

  const handlePageChange = (newPage: number) => {
    const newParams = new URLSearchParams(searchParams);
    newParams.set('page', newPage.toString());
    setSearchParams(newParams);
  };

  const getEventStatusBadge = (event: ClubEvent) => {
    const eventDate = new Date(event.eventDatetime);
    const now = new Date();
    const isPast = eventDate < now;

    if (isPast) {
      return (
        <span className="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-600">
          å·²çµæŸ
        </span>
      );
    }

    return (
      <span className="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-600">
          å³å°‡èˆ‰è¡Œ
        </span>
    );
  };

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="mb-6">
          <Button
            onClick={() => navigate('/dashboard')}
            variant="outline"
            className="mb-4"
          >
            â† è¿”å›å„€è¡¨æ¿
          </Button>
          <h1 className="text-3xl font-bold text-gray-900">æˆ‘çš„æ´»å‹•</h1>
          <p className="text-gray-600 mt-2">ç€è¦½æ‚¨åƒèˆ‡è®€æ›¸æœƒçš„æ‰€æœ‰æ´»å‹•</p>
        </div>

        {/* Filters */}
        <div className="bg-white rounded-lg shadow-sm p-4 mb-6">
          <div className="flex flex-wrap gap-4">
            {/* ç‹€æ…‹ç¯©é¸ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                æ´»å‹•ç‹€æ…‹
              </label>
              <select
                value={statusFilter}
                onChange={(e) => handleFilterChange('status', e.target.value)}
                className="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="all">å…¨éƒ¨</option>
                <option value="published">å³å°‡èˆ‰è¡Œ</option>
                <option value="completed">å·²çµæŸ</option>
                <option value="cancelled">å·²å–æ¶ˆ</option>
              </select>
            </div>

            {/* åƒèˆ‡ç‹€æ…‹ç¯©é¸ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                åƒèˆ‡ç‹€æ…‹
              </label>
              <select
                value={participationFilter}
                onChange={(e) => handleFilterChange('participation', e.target.value)}
                className="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="all">å…¨éƒ¨</option>
                <option value="registered">å·²å ±å</option>
                <option value="not_registered">æœªå ±å</option>
              </select>
            </div>
          </div>
        </div>

        {/* Events List */}
        {loading ? (
          <div className="space-y-4">
            {[1, 2, 3].map((i) => (
              <div key={i} className="bg-white rounded-lg shadow-sm p-6 animate-pulse">
                <div className="h-6 bg-gray-200 rounded w-3/4 mb-4"></div>
                <div className="h-4 bg-gray-200 rounded w-1/2"></div>
              </div>
            ))}
          </div>
        ) : events.length === 0 ? (
          <div className="bg-white rounded-lg shadow-sm p-12 text-center">
            <p className="text-4xl mb-4">ğŸ“…</p>
            <p className="text-gray-600 mb-4">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ´»å‹•</p>
            <Button onClick={() => navigate('/clubs')} variant="primary">
              æ¢ç´¢è®€æ›¸æœƒ
            </Button>
          </div>
        ) : (
          <>
            <div className="space-y-4 mb-6">
              {events.map((event) => (
                <div
                  key={event.id}
                  onClick={() => navigate(`/clubs/${event.clubId}/events/${event.id}`)}
                  className="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow cursor-pointer"
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-3 mb-2">
                        <h3 className="text-xl font-semibold text-gray-900">
                          {event.title}
                        </h3>
                        {event.isRegistered && (
                          <span className="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-600">
                            âœ“ å·²å ±å
                          </span>
                        )}
                        {getEventStatusBadge(event)}
                      </div>

                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          navigate(`/clubs/${event.clubId}`);
                        }}
                        className="text-blue-600 hover:text-blue-700 hover:underline mb-3 inline-block"
                      >
                        ğŸ“š {event.clubName}
                      </button>

                      <div className="flex flex-wrap items-center gap-4 text-sm text-gray-600">
                        <span className="flex items-center">
                          ğŸ•’ {format(new Date(event.eventDatetime), 'yyyyå¹´Mæœˆdæ—¥ HH:mm', { locale: zhTW })}
                        </span>
                        <span className="flex items-center">
                          ğŸ‘¥ {event.currentParticipants}
                          {event.maxParticipants && event.maxParticipants > 0 && ` / ${event.maxParticipants}`} äºº
                        </span>
                      </div>

                      <p className="mt-3 text-gray-600 text-sm line-clamp-2">
                        {event.description}
                      </p>
                    </div>

                    {event.clubCoverImageUrl && (
                      <img
                        src={getImageUrl(event.clubCoverImageUrl) || ''}
                        alt={event.clubName}
                        className="w-20 h-20 rounded-lg object-cover ml-6 flex-shrink-0"
                      />
                    )}
                  </div>
                </div>
              ))}
            </div>

            {/* Pagination */}
            {totalPages > 1 && (
              <div className="flex items-center justify-center gap-2">
                <Button
                  onClick={() => handlePageChange(page - 1)}
                  disabled={page === 1}
                  variant="outline"
                >
                  ä¸Šä¸€é 
                </Button>
                <span className="text-gray-600">
                  ç¬¬ {page} / {totalPages} é 
                </span>
                <Button
                  onClick={() => handlePageChange(page + 1)}
                  disabled={page === totalPages}
                  variant="outline"
                >
                  ä¸‹ä¸€é 
                </Button>
              </div>
            )}
          </>
        )}
      </div>
    </div>
  );
}
```

### 3.2 è¨»å†Šè·¯ç”±

**æª”æ¡ˆ**: `frontend/src/App.tsx`

```typescript
// æ·»åŠ  import
const MyEvents = lazy(() => import('./pages/activities/MyEvents'));

// åœ¨ Routes ä¸­æ·»åŠ 
<Route 
  path="/activities/my-events" 
  element={
    <PrivateRoute>
      <Layout><MyEvents /></Layout>
    </PrivateRoute>
  } 
/>
```

---

## ğŸ¯ Phase 4: æ¸¬è©¦ (2-3 å°æ™‚)

### 4.1 å¾Œç«¯å–®å…ƒæ¸¬è©¦

**æª”æ¡ˆ**: `backend/tests/unit/test_user_event_service.py` (æ–°å»º)

```python
import pytest
from datetime import datetime, timedelta
from app.services.user_event_service import get_user_club_events
from app.models.event import EventStatus

def test_get_user_club_events_basic(session, test_user, test_book_club, test_event):
    """æ¸¬è©¦åŸºæœ¬æ´»å‹•æŸ¥è©¢"""
    events, pagination = get_user_club_events(
        session=session,
        user_id=test_user.id,
        page=1,
        page_size=10
    )
    
    assert len(events) > 0
    assert pagination.total_items > 0
    assert events[0].club_name == test_book_club.name

def test_get_user_club_events_with_status_filter(session, test_user):
    """æ¸¬è©¦ç‹€æ…‹ç¯©é¸"""
    events, _ = get_user_club_events(
        session=session,
        user_id=test_user.id,
        status=EventStatus.PUBLISHED
    )
    
    assert all(event.status == EventStatus.PUBLISHED for event in events)

def test_get_user_club_events_pagination(session, test_user):
    """æ¸¬è©¦åˆ†é åŠŸèƒ½"""
    events_page1, pagination1 = get_user_club_events(
        session=session,
        user_id=test_user.id,
        page=1,
        page_size=2
    )
    
    assert len(events_page1) <= 2
    assert pagination1.page == 1
```

### 4.2 å‰ç«¯æ¸¬è©¦æ¸…å–®

**æ‰‹å‹•æ¸¬è©¦é …ç›®**:

1. **Dashboard é¡¯ç¤ºæ¸¬è©¦**
   - [ ] ç™»å…¥å¾Œé€²å…¥ Dashboard
   - [ ] ç¢ºèªã€Œæœ€è¿‘æ´»å‹•ã€å€å¡Šé¡¯ç¤º
   - [ ] ç¢ºèªé¡¯ç¤ºæœ€å¤š 3 å€‹æ´»å‹•
   - [ ] ç¢ºèªæ´»å‹•æŒ‰æ™‚é–“æ’åº
   - [ ] ç¢ºèªå·²å ±åæ´»å‹•æœ‰ç¶ è‰²å‹¾å‹¾æ¨™ç¤º
   - [ ] é»æ“Šæ´»å‹•å¡ç‰‡å¯è·³è½‰åˆ°æ´»å‹•è©³ç´°é é¢
   - [ ] é»æ“Šè®€æ›¸æœƒåç¨±å¯è·³è½‰åˆ°è®€æ›¸æœƒé é¢
   - [ ] é»æ“Šã€ŒæŸ¥çœ‹å…¨éƒ¨ã€å¯è·³è½‰åˆ°æˆ‘çš„æ´»å‹•é é¢

2. **æˆ‘çš„æ´»å‹•é é¢æ¸¬è©¦**
   - [ ] é€²å…¥ `/activities/my-events` é é¢
   - [ ] ç¢ºèªé¡¯ç¤ºæ‰€æœ‰æ´»å‹•
   - [ ] æ¸¬è©¦ã€Œæ´»å‹•ç‹€æ…‹ã€ç¯©é¸åŠŸèƒ½
   - [ ] æ¸¬è©¦ã€Œåƒèˆ‡ç‹€æ…‹ã€ç¯©é¸åŠŸèƒ½
   - [ ] æ¸¬è©¦åˆ†é åŠŸèƒ½
   - [ ] ç¢ºèªç©ºç‹€æ…‹é¡¯ç¤ºæ­£ç¢º
   - [ ] æ¸¬è©¦è¿”å›å„€è¡¨æ¿æŒ‰éˆ•

3. **é‚Šç•Œæƒ…æ³æ¸¬è©¦**
   - [ ] æœªåŠ å…¥ä»»ä½•è®€æ›¸æœƒçš„ä½¿ç”¨è€…
   - [ ] è®€æ›¸æœƒæ²’æœ‰ä»»ä½•æ´»å‹•
   - [ ] æ‰€æœ‰æ´»å‹•éƒ½å·²çµæŸ

---

## âœ… å®Œæˆæª¢æŸ¥æ¸…å–®

### å¾Œç«¯
- [ ] Schema å®šç¾©å®Œæˆ
- [ ] Service Layer å¯¦ä½œå®Œæˆ
- [ ] API Endpoint å»ºç«‹å®Œæˆ
- [ ] è·¯ç”±è¨»å†Šå®Œæˆ
- [ ] è³‡æ–™åº«ç´¢å¼•å»ºç«‹å®Œæˆ
- [ ] å–®å…ƒæ¸¬è©¦é€šé

### å‰ç«¯
- [x] é¡å‹å®šç¾©å®Œæˆ
- [x] API Service å»ºç«‹å®Œæˆ
- [x] RecentEvents å…ƒä»¶å¯¦ä½œå®Œæˆ
- [x] Dashboard æ•´åˆå®Œæˆ
- [x] MyEvents é é¢å¯¦ä½œå®Œæˆ
- [x] è·¯ç”±è¨»å†Šå®Œæˆ
- [ ] æ‰‹å‹•æ¸¬è©¦é€šé


### æ–‡ä»¶
- [x] API æ–‡ä»¶æ›´æ–°
- [x] ç¨‹å¼ç¢¼è¨»è§£å®Œæ•´
- [ ] README æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰

---

## Dev Agent Record

### Agent Model Used
- Claude 3.5 Sonnet (2024-11-04)

### Debug Log References
- **2024-11-04 ä¿®å¾©æ—¥æœŸæ ¼å¼éŒ¯èª¤**: å‰ç«¯å‡ºç¾ "Invalid time value" éŒ¯èª¤ï¼ŒåŸå› æ˜¯å¾Œç«¯ Schema ä½¿ç”¨ snake_case ä½†å‰ç«¯æœŸå¾… camelCaseã€‚åœ¨ `UserEventRead` Schema ä¸­æ·»åŠ  `Field` åˆ¥åé…ç½®ï¼Œä½¿ç”¨ `serialization_alias` å°‡æ¬„ä½åç¨±è½‰æ›ç‚º camelCase æ ¼å¼ã€‚

### Completion Notes
âœ… **å¾Œç«¯ API å¯¦ä½œå®Œæˆ**
- å»ºç«‹ `UserEventRead` å’Œ `PaginatedUserEventList` schemas
- å¯¦ä½œ `get_user_club_events()` service å‡½æ•¸ï¼Œæ”¯æ´åˆ†é å’Œå¤šç¨®ç¯©é¸æ¢ä»¶
- å»ºç«‹ `GET /api/v1/users/me/events` API ç«¯é»
- åœ¨ `api.py` è¨»å†Šè·¯ç”±ï¼Œprefix ç‚º `/api/v1/users`

âœ… **å‰ç«¯ Dashboard å¯¦ä½œå®Œæˆ**
- å»ºç«‹ `userEventService.ts` åŒ…å«é¡å‹å®šç¾©å’Œ API å‘¼å«å‡½æ•¸
- å»ºç«‹ `RecentEvents.tsx` å…ƒä»¶ï¼Œé¡¯ç¤ºæœ€æ–° 3 å€‹æ´»å‹•
- å¯¦ä½œæ´»å‹•å¡ç‰‡ UIï¼ŒåŒ…å«å·²å ±åæ¨™ç¤ºã€ç›¸å°æ™‚é–“é¡¯ç¤ºã€å°é¢åœ–ç‰‡
- æ›´æ–° `Dashboard.tsx`ï¼Œæ›¿æ› `ActivityTimeline` ç‚º `RecentEvents`

âœ… **æˆ‘çš„æ´»å‹•é é¢å¯¦ä½œå®Œæˆ**
- å»ºç«‹ `MyEvents.tsx` å®Œæ•´åˆ—è¡¨é é¢
- å¯¦ä½œç‹€æ…‹ç¯©é¸ï¼ˆå…¨éƒ¨/å³å°‡èˆ‰è¡Œ/å·²çµæŸ/å·²å–æ¶ˆï¼‰
- å¯¦ä½œåƒèˆ‡ç‹€æ…‹ç¯©é¸ï¼ˆå…¨éƒ¨/å·²å ±å/æœªå ±åï¼‰
- å¯¦ä½œåˆ†é åŠŸèƒ½ï¼Œæ¯é é¡¯ç¤º 20 å€‹æ´»å‹•
- ä½¿ç”¨ `useSearchParams` ç®¡ç† URL åƒæ•¸ç‹€æ…‹
- åœ¨ `App.tsx` è¨»å†Šè·¯ç”± `/activities/my-events`

### File List
**æ–°å¢æª”æ¡ˆ:**
- `backend/app/schemas/user_event.py` - ä½¿ç”¨è€…æ´»å‹• Schema
- `backend/app/services/user_event_service.py` - ä½¿ç”¨è€…æ´»å‹•æœå‹™å±¤
- `backend/app/api/endpoints/user_events.py` - ä½¿ç”¨è€…æ´»å‹• API ç«¯é»
- `frontend/src/services/userEventService.ts` - ä½¿ç”¨è€…æ´»å‹•å‰ç«¯æœå‹™
- `frontend/src/components/dashboard/RecentEvents.tsx` - æœ€è¿‘æ´»å‹•å…ƒä»¶
- `frontend/src/pages/activities/MyEvents.tsx` - æˆ‘çš„æ´»å‹•é é¢

**ä¿®æ”¹æª”æ¡ˆ:**
- `backend/app/api/api.py` - è¨»å†Š user_events router
- `frontend/src/pages/Dashboard.tsx` - æ›¿æ›ç‚º RecentEvents å…ƒä»¶
- `frontend/src/App.tsx` - æ–°å¢ MyEvents è·¯ç”±

### Change Log
1. **2024-11-04 å¾Œç«¯ API å¯¦ä½œ** - å»ºç«‹å®Œæ•´çš„ä½¿ç”¨è€…æ´»å‹•æŸ¥è©¢ APIï¼Œæ”¯æ´åˆ†é å’Œç¯©é¸
2. **2024-11-04 å‰ç«¯ Dashboard** - å¯¦ä½œæœ€è¿‘æ´»å‹•é¡¯ç¤ºå…ƒä»¶ï¼Œæ•´åˆåˆ°å„€è¡¨æ¿
3. **2024-11-04 æˆ‘çš„æ´»å‹•é é¢** - å»ºç«‹å®Œæ•´çš„æ´»å‹•åˆ—è¡¨é é¢ï¼Œæ”¯æ´ç¯©é¸å’Œåˆ†é 
